<p>
  <i id="p_0" class="pid"></i>A Reach step occurs in the continuation of a deploy statement or commit statement.
  It represents the actions taken by each of the participants in an application.<a href="#p_0" class="pid">0</a>
</p>
<h2 id="ref-programs-step-stmts" class="refHeader">Statements<a aria-hidden="true" tabindex="-1" href="#ref-programs-step-stmts"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_1" class="pid"></i>Any statements valid for a <a href="/rsh/compute/#ref-programs-compute-stmts">computation</a> are valid for a step.
  However, some additional statements are allowed.<a href="#p_1" class="pid">1</a>
</p>
<h3 id="ref-programs-only-step" class="refHeader"><code>only</code> and <code>each</code><a aria-hidden="true" tabindex="-1" href="#ref-programs-only-step"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_only" data-scope="rsh" data-symbol="only"></span></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.only(() => {
  const pretzel = interact.random(); });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">pretzel</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">random</span><span style="color: #24292F">(); });</span></li></ol></pre>
<p>
  <i id="p_2" class="pid"></i>A local step statement is written <span class="snip"><span style="color: #0550AE">PART</span><span style="color: #24292F">.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">BLOCK</span><span style="color: #24292F">)</span></span>, where <span class="snip"><span style="color: #0550AE">PART</span></span> is a participant identifier and <span class="snip"><span style="color: #0550AE">BLOCK</span></span> is a block.
  Within <span class="snip"><span style="color: #0550AE">BLOCK</span></span>, <span class="snip"><span style="color: #0550AE">PART</span></span> is bound to the address of the participant.
  Any bindings defined within the block of a local step are available in the statement's tail as new local state.
  For example,<a href="#p_2" class="pid">2</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.only(() => {
  const x = 3; });
Alice.only(() => {
  const y = x + 1; });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">; });</span></li><li value="3"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">y</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> x </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">; });</span></li></ol></pre>
<p><i id="p_3" class="pid"></i>is a valid program where <span class="snip"><span style="color: #24292F">Alice</span></span>'s local state includes the private values <span class="snip"><span style="color: #24292F">x</span></span> (bound to <span class="snip"><span style="color: #0550AE">3</span></span>) and <span class="snip"><span style="color: #24292F">y</span></span> (bound to <span class="snip"><span style="color: #0550AE">4</span></span>). However, such bindings are <em>not</em> consensus state, so they are purely local state. For example,<a href="#p_3" class="pid">3</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.only(() => {
  const x = 3; });
Bob.only(() => {
  const y = x + 1; });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">; });</span></li><li value="3"><span style="color: #24292F">Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">y</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> x </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">; });</span></li></ol></pre>
<p><i id="p_4" class="pid"></i>is an invalid program, because <span class="snip"><span style="color: #24292F">Bob</span></span> does not know <span class="snip"><span style="color: #24292F">x</span></span>.<a href="#p_4" class="pid">4</a></p>
<p>
  <i id="p_5" class="pid"></i>The <span class="term" id="term_interact%20shorthand">interact shorthand</span>, written <span class="snip"><span style="color: #0550AE">PART</span><span style="color: #24292F">.interact.</span><span style="color: #8250DF">METHOD</span><span style="color: #24292F">(</span><span style="color: #0550AE">EXPR_0</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #24292F">, EXPR_n)</span></span>, is available for calling an <span class="snip"><span style="color: #24292F">interact</span></span> function
  from outside of an <span class="snip"><span style="color: #24292F">only</span></span> block. Such functions must return <span class="snip"><span style="color: #24292F">Null</span></span>; therefore, they are only useful
  if they produce side-effects, such as logging on the frontend. For example, the
  function <span class="snip"><span style="color: #24292F">log</span></span> in the participant interact interface of <span class="snip"><span style="color: #24292F">Alice</span></span> may be called via:<a href="#p_5" class="pid">5</a>
</p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.interact.log(x);" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.interact.</span><span style="color: #8250DF">log</span><span style="color: #24292F">(x);</span></li></ol></pre>
<hr>
<p><span class="ref" id="rsh_each" data-scope="rsh" data-symbol="each"></span></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="each([Alice, Bob], () => {
  const pretzel = interact.random(); });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">each</span><span style="color: #24292F">([Alice, Bob], () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">pretzel</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">random</span><span style="color: #24292F">(); });</span></li></ol></pre>
<p>
  <i id="p_6" class="pid"></i>An <span class="term" id="term_each">each</span> local step statement can be written as <span class="snip"><span style="color: #8250DF">each</span><span style="color: #24292F">(</span><span style="color: #8250DF">PART_TUPLE</span><span style="color: #24292F"> () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">BLOCK</span><span style="color: #24292F">)</span></span>, where <span class="snip"><span style="color: #0550AE">PART_TUPLE</span></span> is a tuple of participants and <span class="snip"><span style="color: #0550AE">BLOCK</span></span> is a block.
  It is an abbreviation of many local step statements that could have been written with <span class="snip"><span style="color: #24292F">only</span></span>.<a href="#p_6" class="pid">6</a>
</p>
<h3 id="pay-amounts" class="refHeader">Pay Amounts<a aria-hidden="true" tabindex="-1" href="#pay-amounts"><span class="icon icon-link"></span></a></h3>
<p><i id="p_7" class="pid"></i>A <span class="term" id="term_pay%20amount">pay amount</span> is either:<a href="#p_7" class="pid">7</a></p>
<ul>
  <li><i id="p_8" class="pid"></i>An integer, denoting an amount of network tokens; or,<a href="#p_8" class="pid">8</a></li>
  <li><i id="p_9" class="pid"></i>A tuple of token amounts.<a href="#p_9" class="pid">9</a></li>
</ul>
<p><i id="p_10" class="pid"></i>A <span class="term" id="term_token%20amount">token amount</span> is either:<a href="#p_10" class="pid">10</a></p>
<ul>
  <li><i id="p_11" class="pid"></i>An integer, denoting an amount of network tokens; or,<a href="#p_11" class="pid">11</a></li>
  <li><i id="p_12" class="pid"></i>A tuple with two elements, where the first is an integer, denoting an amount of non-network tokens, and the second is <span class="snip"><span style="color: #24292F">Token</span></span>, specifying a particular non-network token.<a href="#p_12" class="pid">12</a></li>
</ul>
<p><i id="p_13" class="pid"></i>For example, these are all pay amounts:<a href="#p_13" class="pid">13</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="0
5
[ 5 ]
[ 5, [ 2, gil ] ]
[ [ 2, gil ], 5 ]
[ 5, [ 2, gil ], [ 8, zorkmids ] ]" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #0550AE">0</span></li><li value="2"><span style="color: #0550AE">5</span></li><li value="3"><span style="color: #24292F">[ </span><span style="color: #0550AE">5</span><span style="color: #24292F"> ]</span></li><li value="4"><span style="color: #24292F">[ </span><span style="color: #0550AE">5</span><span style="color: #24292F">, [ </span><span style="color: #0550AE">2</span><span style="color: #24292F">, gil ] ]</span></li><li value="5"><span style="color: #24292F">[ [ </span><span style="color: #0550AE">2</span><span style="color: #24292F">, gil ], </span><span style="color: #0550AE">5</span><span style="color: #24292F"> ]</span></li><li value="6"><span style="color: #24292F">[ </span><span style="color: #0550AE">5</span><span style="color: #24292F">, [ </span><span style="color: #0550AE">2</span><span style="color: #24292F">, gil ], [ </span><span style="color: #0550AE">8</span><span style="color: #24292F">, zorkmids ] ]</span></li></ol></pre>
<p>
  <i id="p_14" class="pid"></i>It is invalid for a pay amount to specify an amount of tokens multiple times.
  For example, these are invalid pay amounts:<a href="#p_14" class="pid">14</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="[ 1, 2 ]
[ [2, gil], [1, gil] ]" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">[ </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F"> ]</span></li><li value="2"><span style="color: #24292F">[ [</span><span style="color: #0550AE">2</span><span style="color: #24292F">, gil], [</span><span style="color: #0550AE">1</span><span style="color: #24292F">, gil] ]</span></li></ol></pre>
<p>
  <i id="p_15" class="pid"></i>The ordering of a pay amount is only significant when used within a fork statement or parallel reduce statement that specifies a <span class="snip"><span style="color: #24292F">paySpec</span></span>.
  In this case, payments are expected to be a tuple where the first element is an integer pay amount, and the rest of the elements are token amount tuples. The ordering of the token amount elements should match the ordering in <span class="snip"><span style="color: #24292F">paySpec</span></span>. For example,<a href="#p_15" class="pid">15</a>
</p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text=".paySpec([tokA, tokB])" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">.</span><span style="color: #8250DF">paySpec</span><span style="color: #24292F">([tokA, tokB])</span></li></ol></pre>
<p><i id="p_16" class="pid"></i>will indicate that <span class="snip"><span style="color: #24292F">fork</span></span> payments should be of the format:<a href="#p_16" class="pid">16</a></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="[ NETWORK_TOKEN_AMT, [ amtA, tokA ], [ amtB, tokB ] ]" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">[ </span><span style="color: #0550AE">NETWORK_TOKEN_AMT</span><span style="color: #24292F">, [ amtA, tokA ], [ amtB, tokB ] ]</span></li></ol></pre>
<div class="note">
  <p><i id="p_17" class="pid"></i>Reach assumes that network tokens and non-network tokens behave identically, but often they do not; <a href="/guide/nntoks/#guide-nntoks">this article</a> discusses the causes and consequences of this.<a href="#p_17" class="pid">17</a></p>
</div>
<h3 id="publish---pay---when--and--timeout" class="refHeader"><code>publish</code>, <code>pay</code>, <code>when</code>, and <code>timeout</code><a aria-hidden="true" tabindex="-1" href="#publish---pay---when--and--timeout"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_publish" data-scope="rsh" data-symbol="publish"></span><span class="ref" id="rsh_pay" data-scope="rsh" data-symbol="pay"></span><span class="ref" id="rsh_when" data-scope="rsh" data-symbol="when"></span><span class="ref" id="rsh_timeout" data-scope="rsh" data-symbol="timeout"></span></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.publish(wagerAmount)
     .pay(wagerAmount)
     .timeout(DELAY, () => {
       Bob.publish();
       commit();
       return false; });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wagerAmount)</span></li><li value="2"><span style="color: #24292F">     .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wagerAmount)</span></li><li value="3"><span style="color: #24292F">     .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F">       Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="5"><span style="color: #24292F">       </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="6"><span style="color: #24292F">       </span><span style="color: #CF222E">return</span><span style="color: #24292F"> </span><span style="color: #0550AE">false</span><span style="color: #24292F">; });</span></li></ol></pre>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.publish(wagerAmount)
     .pay(wagerAmount)
     .timeout(DELAY, () => closeTo(Bob, false));" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wagerAmount)</span></li><li value="2"><span style="color: #24292F">     .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wagerAmount)</span></li><li value="3"><span style="color: #24292F">     .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, </span><span style="color: #0550AE">false</span><span style="color: #24292F">));</span></li></ol></pre>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.publish(wagerAmount)
     .pay(wagerAmount)
     .timeout(false);" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(wagerAmount)</span></li><li value="2"><span style="color: #24292F">     .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(wagerAmount)</span></li><li value="3"><span style="color: #24292F">     .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">false</span><span style="color: #24292F">);</span></li></ol></pre>
<div class="note">
  <p><i id="p_18" class="pid"></i>If you're unsure of what kind of consensus transfer to use, you may want to read the <a href="/guide/ctransfers/#guide-ctransfers">explanation of the differences</a> in the Guide.<a href="#p_18" class="pid">18</a></p>
</div>
<p><i id="p_19" class="pid"></i>A consensus transfer is written<a href="#p_19" class="pid">19</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="PART_EXPR.publish(ID_0, ..., ID_n)
 .pay(PAY_EXPR)
 .when(WHEN_EXPR)
 .timeout(DELAY_EXPR, () =>
   TIMEOUT_BLOCK)
 // or
 .throwTimeout(DELAY_EXPR, THROWN_EXPR)" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #0550AE">PART_EXPR</span><span style="color: #24292F">.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(</span><span style="color: #0550AE">ID_0</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #24292F">, ID_n)</span></li><li value="2"><span style="color: #24292F"> .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(</span><span style="color: #0550AE">PAY_EXPR</span><span style="color: #24292F">)</span></li><li value="3"><span style="color: #24292F"> .</span><span style="color: #8250DF">when</span><span style="color: #24292F">(</span><span style="color: #0550AE">WHEN_EXPR</span><span style="color: #24292F">)</span></li><li value="4"><span style="color: #24292F"> .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY_EXPR</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span></li><li value="5"><span style="color: #24292F">   </span><span style="color: #0550AE">TIMEOUT_BLOCK</span><span style="color: #24292F">)</span></li><li value="6"><span style="color: #24292F"> </span><span style="color: #6E7781">// or</span></li><li value="7"><span style="color: #24292F"> .</span><span style="color: #8250DF">throwTimeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY_EXPR</span><span style="color: #24292F">, </span><span style="color: #0550AE">THROWN_EXPR</span><span style="color: #24292F">)</span></li></ol></pre>
<p>
  <i id="p_20" class="pid"></i>where <span class="snip"><span style="color: #0550AE">PART_EXPR</span></span> is an expression that evaluates to a participant or race expression,
  <span class="snip"><span style="color: #0550AE">ID_0</span></span> through <span class="snip"><span style="color: #24292F">ID_n</span></span> are identifiers for <span class="snip"><span style="color: #0550AE">PART</span></span>'s public local state,
  <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span> is a public expression evaluating to a pay amount,
  <span class="snip"><span style="color: #0550AE">WHEN_EXPR</span></span> is a public expression evaluating to a boolean and determines if the consensus transfer takes place,
  <span class="snip"><span style="color: #0550AE">DELAY_EXPR</span></span> is a public expression that depends on only consensus state and evaluates to a time argument,
  <span class="snip"><span style="color: #0550AE">TIMEOUT_BLOCK</span></span> is a timeout block, which will be executed after the <span class="snip"><span style="color: #0550AE">DELAY_EXPR</span></span> time argument passes without <span class="snip"><span style="color: #0550AE">PART</span></span> executing this consensus transfer.<a href="#p_20" class="pid">20</a>
</p>
<p>
  <i id="p_21" class="pid"></i>All of the expressions within a consensus transfer are evaluated in a <span class="term" id="term_pure">pure</span> context, which may not alter the state of the
  application.
  The <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span>, <span class="snip"><span style="color: #0550AE">WHEN_EXPR</span></span>, and <span class="snip"><span style="color: #0550AE">DELAY_EXPR</span></span> expressions must refer only to the consensus state, including the new data published via the <span class="snip"><span style="color: #24292F">.publish</span></span> component.<a href="#p_21" class="pid">21</a>
</p>
<p>
  <i id="p_22" class="pid"></i>The continuation of a consensus transfer statement is a consensus step, which is finalized with a commit statement.
  The continuation of a timeout block is the same as the continuation of the function the timeout occurs within.<a href="#p_22" class="pid">22</a>
</p>
<div class="note">
  <p><i id="p_23" class="pid"></i>See <a href="/guide/timeout/#guide-timeout">the guide section on non-participation</a> to understand when to use timeouts and how to use them most effectively.<a href="#p_23" class="pid">23</a></p>
</div>
<p>
  <i id="p_24" class="pid"></i>The <span class="snip"><span style="color: #24292F">publish</span></span> component exclusive-or the <span class="snip"><span style="color: #24292F">pay</span></span> component may be omitted, if either there is no publication or no transfer of network tokens to accompany this consensus transfer.
  The <span class="snip"><span style="color: #24292F">when</span></span> component may always be omitted, in which case it is assumed to be <span class="snip"><span style="color: #0550AE">true</span></span>.
  <span class="snip"><span style="color: #24292F">publish</span></span> or <span class="snip"><span style="color: #24292F">pay</span></span> must occur first, after which components may occur in any order.
  For example, the following are all valid:<a href="#p_24" class="pid">24</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.publish(coinFlip);

Alice.pay(penaltyAmount);

Alice.pay(penaltyAmount).publish(coinFlip);

Alice.publish(coinFlip)
     .timeout(DELAY, () => closeTo(Bob, () => exit()));

Alice.pay(penaltyAmount)
     .timeout(DELAY, () => {
       Bob.publish();
       commit();
       exit(); });

Alice.publish(bid).when(wantsToBid);" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(coinFlip);</span></li><li value="2"></li><li value="3"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(penaltyAmount);</span></li><li value="4"></li><li value="5"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(penaltyAmount).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(coinFlip);</span></li><li value="6"></li><li value="7"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(coinFlip)</span></li><li value="8"><span style="color: #24292F">     .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">closeTo</span><span style="color: #24292F">(Bob, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #8250DF">exit</span><span style="color: #24292F">()));</span></li><li value="9"></li><li value="10"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(penaltyAmount)</span></li><li value="11"><span style="color: #24292F">     .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="12"><span style="color: #24292F">       Bob.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="13"><span style="color: #24292F">       </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="14"><span style="color: #24292F">       </span><span style="color: #8250DF">exit</span><span style="color: #24292F">(); });</span></li><li value="15"></li><li value="16"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(bid).</span><span style="color: #8250DF">when</span><span style="color: #24292F">(wantsToBid);</span></li></ol></pre>
<p>
  <i id="p_25" class="pid"></i>The <span class="snip"><span style="color: #24292F">timeout</span></span> component must be included if <span class="snip"><span style="color: #24292F">when</span></span> is not statically <span class="snip"><span style="color: #0550AE">true</span></span>.
  This ensures that your clients will eventually complete the program.
  If a consensus transfer is a guaranteed race between non-class participants and a participant class that <em>may</em> attempt to transfer (i.e. <span class="snip"><span style="color: #24292F">when</span></span> is not statically <span class="snip"><span style="color: #0550AE">false</span></span>), then a <span class="snip"><span style="color: #24292F">timeout</span></span> may be explicitly omitted by writing <span class="snip"><span style="color: #24292F">.</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">false</span><span style="color: #24292F">)</span></span>.<a href="#p_25" class="pid">25</a>
</p>
<p>
  <i id="p_26" class="pid"></i><span class="snip"><span style="color: #24292F">.throwTimeout</span></span> may be used in place of <span class="snip"><span style="color: #24292F">.timeout</span></span>. It accepts a <span class="snip"><span style="color: #0550AE">DELAY_EXPR</span></span> and an <span class="snip"><span style="color: #0550AE">EXPR</span></span>, which will be thrown if a timeout should occur.
  If an <span class="snip"><span style="color: #0550AE">EXPR</span></span> is not provided, then <span class="snip"><span style="color: #0550AE">null</span></span> will be thrown.
  If a consensus transfer uses <span class="snip"><span style="color: #24292F">.throwTimeout</span></span>, it must be within a try statement.<a href="#p_26" class="pid">26</a>
</p>
<p><i id="p_27" class="pid"></i>If a consensus transfer specifies a single participant, which has not yet been fixed in the application and is not a participant class, then this statement does so; therefore, after it the <span class="snip"><span style="color: #0550AE">PART</span></span> may be used as an address.<a href="#p_27" class="pid">27</a></p>
<p><i id="p_28" class="pid"></i>If a consensus transfer specificies a single participant class, then all members of that class will attempt to perform the transfer, but only one will succeed.<a href="#p_28" class="pid">28</a></p>
<p>
  <i id="p_29" class="pid"></i>A consensus transfer binds the identifiers <span class="snip"><span style="color: #0550AE">ID_0</span></span> through <span class="snip"><span style="color: #24292F">ID_n</span></span> for all participants to the values included in the consensus transfer, overwriting any bindings that already exist for those identifiers.
  If an existing participant, not included in <span class="snip"><span style="color: #0550AE">PART_EXPR</span></span>, has previously bound one of these identifiers, then the program is not valid. In other words, the following program is not valid:<a href="#p_29" class="pid">29</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="Alice.only(() => {
 const x = 1; });
Bob.only(() => {
 const x = 2; });
Claire.only(() => {
 const x = 3; });
race(Alice, Bob).publish(x);
commit();" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">; });</span></li><li value="3"><span style="color: #24292F">Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="4"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F">; });</span></li><li value="5"><span style="color: #24292F">Claire.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="6"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">3</span><span style="color: #24292F">; });</span></li><li value="7"><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(x);</span></li><li value="8"><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<p>
  <i id="p_30" class="pid"></i>because <span class="snip"><span style="color: #24292F">Claire</span></span> is not included in the <span class="snip"><span style="color: #24292F">race</span></span>.
  However, if we were to rename <span class="snip"><span style="color: #24292F">Claire</span></span>'s <span class="snip"><span style="color: #24292F">x</span></span> into <span class="snip"><span style="color: #24292F">y</span></span>, then it would be valid, because although <span class="snip"><span style="color: #24292F">Alice</span></span> and <span class="snip"><span style="color: #24292F">Bob</span></span> both bind <span class="snip"><span style="color: #24292F">x</span></span>, they participate in the <span class="snip"><span style="color: #24292F">race</span></span>, so it is allowed.
  In the tail of this program, <span class="snip"><span style="color: #24292F">x</span></span> is bound to either <span class="snip"><span style="color: #0550AE">1</span></span> or <span class="snip"><span style="color: #0550AE">2</span></span>, i.e., either <span class="snip"><span style="color: #24292F">Alice</span></span> or <span class="snip"><span style="color: #24292F">Bob</span></span>'s value is overwritten.
  This overwriting applies even if <span class="snip"><span style="color: #24292F">Alice</span></span> wins and <span class="snip"><span style="color: #24292F">Alice</span></span> is a participant class, i.e., the value of <span class="snip"><span style="color: #24292F">x</span></span> in the tail is guaranteed to be the single value that was agreed upon in the consensus.<a href="#p_30" class="pid">30</a>
</p>
<h3 id="fork" class="refHeader"><code>fork</code><a aria-hidden="true" tabindex="-1" href="#fork"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_fork" data-scope="rsh" data-symbol="fork"></span><span class="ref" id="rsh_paySpec" data-scope="rsh" data-symbol="paySpec"></span></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="fork()
.case(Alice, (() => ({
  msg: 19,
  when: declassify(interact.keepGoing()) })),
  ((v) => v),
  (v) => {
    require(v == 19);
    transfer(wager + 19).to(this);
    commit();
    exit();
  })
.case(Bob, (() => ({
  when: declassify(interact.keepGoing()) })),
  ((_) => wager),
  (_) => {
    commit();

    Alice.only(() => interact.showOpponent(Bob));

    race(Alice, Bob).publish();
    transfer(2 * wager).to(this);
    commit();
    exit();
  })
.timeout(deadline, () => {
  race(Alice, Bob).publish();
  transfer(wager).to(this);
  commit();
  exit(); });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">fork</span><span style="color: #24292F">()</span></li><li value="2"><span style="color: #24292F">.</span><span style="color: #8250DF">case</span><span style="color: #24292F">(Alice, (() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="3"><span style="color: #24292F">  msg: </span><span style="color: #0550AE">19</span><span style="color: #24292F">,</span></li><li value="4"><span style="color: #24292F">  when: </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">keepGoing</span><span style="color: #24292F">()) })),</span></li><li value="5"><span style="color: #24292F">  ((</span><span style="color: #953800">v</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> v),</span></li><li value="6"><span style="color: #24292F">  (</span><span style="color: #953800">v</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="7"><span style="color: #24292F">    </span><span style="color: #0550AE">require</span><span style="color: #24292F">(v </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">19</span><span style="color: #24292F">);</span></li><li value="8"><span style="color: #24292F">    </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(wager </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">19</span><span style="color: #24292F">).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="9"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="10"><span style="color: #24292F">    </span><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></li><li value="11"><span style="color: #24292F">  })</span></li><li value="12"><span style="color: #24292F">.</span><span style="color: #8250DF">case</span><span style="color: #24292F">(Bob, (() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> ({</span></li><li value="13"><span style="color: #24292F">  when: </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">keepGoing</span><span style="color: #24292F">()) })),</span></li><li value="14"><span style="color: #24292F">  ((</span><span style="color: #953800">_</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> wager),</span></li><li value="15"><span style="color: #24292F">  (</span><span style="color: #953800">_</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="16"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="17"></li><li value="18"><span style="color: #24292F">    Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">showOpponent</span><span style="color: #24292F">(Bob));</span></li><li value="19"></li><li value="20"><span style="color: #24292F">    </span><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="21"><span style="color: #24292F">    </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(</span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="22"><span style="color: #24292F">    </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="23"><span style="color: #24292F">    </span><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></li><li value="24"><span style="color: #24292F">  })</span></li><li value="25"><span style="color: #24292F">.</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(deadline, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="26"><span style="color: #24292F">  </span><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="27"><span style="color: #24292F">  </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="28"><span style="color: #24292F">  </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="29"><span style="color: #24292F">  </span><span style="color: #8250DF">exit</span><span style="color: #24292F">(); });</span></li></ol></pre>
<div class="note">
  <p><i id="p_31" class="pid"></i>If you're unsure of what kind of consensus transfer to use, you may want to read the <a href="/guide/ctransfers/#guide-ctransfers">explanation of the differences</a> in the Guide.<a href="#p_31" class="pid">31</a></p>
</div>
<p><i id="p_32" class="pid"></i>A <span class="term" id="term_fork%20statement">fork statement</span> is written:<a href="#p_32" class="pid">32</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="fork()
.paySpec(TOKENS_EXPR)
.case(PART_EXPR,
  PUBLISH_EXPR,
  PAY_EXPR,
  CONSENSUS_EXPR)
.api(API_EXPR,
  API_ASSUME_EXPR,
  API_PAY_EXPR,
  API_CONSENSUS_EXPR)
.timeout(DELAY_EXPR, () =>
  TIMEOUT_BLOCK);
// or
.throwTimeout(DELAY_EXPR, THROW_EXPR)" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">fork</span><span style="color: #24292F">()</span></li><li value="2"><span style="color: #24292F">.</span><span style="color: #8250DF">paySpec</span><span style="color: #24292F">(</span><span style="color: #0550AE">TOKENS_EXPR</span><span style="color: #24292F">)</span></li><li value="3"><span style="color: #24292F">.</span><span style="color: #8250DF">case</span><span style="color: #24292F">(</span><span style="color: #0550AE">PART_EXPR</span><span style="color: #24292F">,</span></li><li value="4"><span style="color: #24292F">  </span><span style="color: #0550AE">PUBLISH_EXPR</span><span style="color: #24292F">,</span></li><li value="5"><span style="color: #24292F">  </span><span style="color: #0550AE">PAY_EXPR</span><span style="color: #24292F">,</span></li><li value="6"><span style="color: #24292F">  </span><span style="color: #0550AE">CONSENSUS_EXPR</span><span style="color: #24292F">)</span></li><li value="7"><span style="color: #24292F">.</span><span style="color: #8250DF">api</span><span style="color: #24292F">(</span><span style="color: #0550AE">API_EXPR</span><span style="color: #24292F">,</span></li><li value="8"><span style="color: #24292F">  </span><span style="color: #0550AE">API_ASSUME_EXPR</span><span style="color: #24292F">,</span></li><li value="9"><span style="color: #24292F">  </span><span style="color: #0550AE">API_PAY_EXPR</span><span style="color: #24292F">,</span></li><li value="10"><span style="color: #24292F">  </span><span style="color: #0550AE">API_CONSENSUS_EXPR</span><span style="color: #24292F">)</span></li><li value="11"><span style="color: #24292F">.</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY_EXPR</span><span style="color: #24292F">, () </span><span style="color: #CF222E">=&gt;</span></li><li value="12"><span style="color: #24292F">  </span><span style="color: #0550AE">TIMEOUT_BLOCK</span><span style="color: #24292F">);</span></li><li value="13"><span style="color: #6E7781">// or</span></li><li value="14"><span style="color: #24292F">.</span><span style="color: #8250DF">throwTimeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY_EXPR</span><span style="color: #24292F">, </span><span style="color: #0550AE">THROW_EXPR</span><span style="color: #24292F">)</span></li></ol></pre>
<p><i id="p_33" class="pid"></i>where:<a href="#p_33" class="pid">33</a></p>
<ul>
  <li><i id="p_34" class="pid"></i><span class="snip"><span style="color: #0550AE">TOKENS_EXPR</span></span> is an expression that evaluates to a tuple of <span class="snip"><span style="color: #24292F">Token</span></span>s;<a href="#p_34" class="pid">34</a></li>
  <li><i id="p_35" class="pid"></i><span class="snip"><span style="color: #0550AE">PART_EXPR</span></span> is an expression that evaluates to a participant;<a href="#p_35" class="pid">35</a></li>
  <li><i id="p_36" class="pid"></i><span class="snip"><span style="color: #0550AE">PUBLISH_EXPR</span></span> is a syntactic arrow expression that is evaluated in a local step for the specified participant and must evaluate to an object that may contain a <code>msg</code> field, which may be of any type, and a <code>when</code> field, which must be a boolean;<a href="#p_36" class="pid">36</a></li>
  <li><i id="p_37" class="pid"></i>(optional) <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span> is an expression that evaluates to a function parameterized over the <code>msg</code> value and returns a pay amount; if this component is left-out, it is synthesized to zero;<a href="#p_37" class="pid">37</a></li>
  <li><i id="p_38" class="pid"></i><span class="snip"><span style="color: #0550AE">CONSENSUS_EXPR</span></span> is a syntactic arrow expression parameterized over the <code>msg</code> value which is evaluated in a consensus step;<a href="#p_38" class="pid">38</a></li>
  <li><i id="p_39" class="pid"></i><span class="snip"><span style="color: #0550AE">API_EXPR</span></span> is an expression that evaluates to an API member function;<a href="#p_39" class="pid">39</a></li>
  <li><i id="p_40" class="pid"></i>(optional) <span class="snip"><span style="color: #0550AE">API_ASSUME_EXPR</span></span> is a function parameterized over the input to the API member function which is evaluated for effect in a local step; thus it may be used to add <span class="snip"><span style="color: #24292F">assume</span></span> constraints on the values given by the API; if this is absent, then it is synthesized to an empty function; if it is present, then <span class="snip"><span style="color: #0550AE">API_PAY_EXPR</span></span> must be included;<a href="#p_40" class="pid">40</a></li>
  <li><i id="p_41" class="pid"></i>(optional) <span class="snip"><span style="color: #0550AE">API_PAY_EXPR</span></span> is a function parameterized over the input to the API member function which is evaluated to determine the pay amount, like <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span>;<a href="#p_41" class="pid">41</a></li>
  <li><i id="p_42" class="pid"></i><span class="snip"><span style="color: #0550AE">API_CONSENSUS_EXPR</span></span> is a function parameterized over the input to the API member function and a function that returns a value to the API call; this function must be called;<a href="#p_42" class="pid">42</a></li>
  <li><i id="p_43" class="pid"></i>the <span class="snip"><span style="color: #24292F">timeout</span></span> and <span class="snip"><span style="color: #24292F">throwTimeout</span></span> parameter are as in an consensus transfer.<a href="#p_43" class="pid">43</a></li>
</ul>
<p>
  <i id="p_44" class="pid"></i>In the discussion of <span class="snip"><span style="color: #24292F">.api</span></span> component, the phrase "parameterized over the input" means that if an API function has two arguments, such as <span class="snip"><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt, UInt], Null)</span></span>, then the corresponding expression must receive two arguments.
  For example, the <span class="snip"><span style="color: #0550AE">API_PAY_EXPR</span></span> component would be a function that accepts two arguments, while the <span class="snip"><span style="color: #0550AE">API_CONSENSUS_EXPR</span></span> would be a function that acccepts three arguments---the two for the API and the function used to return a value.
  All API functions must rely only on consensus state and the function domain.<a href="#p_44" class="pid">44</a>
</p>
<p><i id="p_45" class="pid"></i>If the <code>msg</code> field is absent from the object returned from <span class="snip"><span style="color: #0550AE">PUBLISH_EXPR</span></span>, then it is treated as if it were <span class="snip"><span style="color: #0550AE">null</span></span>.<a href="#p_45" class="pid">45</a></p>
<p><i id="p_46" class="pid"></i>If the <code>when</code> field is absent from the object returned from <span class="snip"><span style="color: #0550AE">PUBLISH_EXPR</span></span>, then it is treated as if it were <span class="snip"><span style="color: #0550AE">true</span></span>.<a href="#p_46" class="pid">46</a></p>
<p><i id="p_47" class="pid"></i>If the <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span> is absent, then it is treated as if it were <span class="snip"><span style="color: #24292F">(</span><span style="color: #953800">_</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span></span>.<a href="#p_47" class="pid">47</a></p>
<p><i id="p_48" class="pid"></i>The <span class="snip"><span style="color: #0550AE">TOKENS_EXPR</span></span> and <span class="snip"><span style="color: #0550AE">PAY_EXPR</span></span> have the same restrictions as the <span class="snip"><span style="color: #24292F">.pay</span></span> component of a consensus transfer: i.e., they must be pure and can only refer to consensus state.<a href="#p_48" class="pid">48</a></p>
<p><i id="p_49" class="pid"></i>The <span class="snip"><span style="color: #24292F">.case</span></span> and <span class="snip"><span style="color: #24292F">.api</span></span> components may be repeated many times.<a href="#p_49" class="pid">49</a></p>
<p>
  <i id="p_50" class="pid"></i>The same participant may specify multiple cases.
  In this situation, the order of the cases is significant.
  That is, a subsequent case will only be evaluated if the prior case's <code>when</code> field is <span class="snip"><span style="color: #0550AE">false</span></span>.<a href="#p_50" class="pid">50</a>
</p>
<p><i id="p_51" class="pid"></i>If the participant specified by <span class="snip"><span style="color: #0550AE">PART_EXPR</span></span> is not already fixed (in the sense of <span class="snip"><span style="color: #24292F">Participant.set</span></span>), then if it wins the <span class="snip"><span style="color: #24292F">race</span></span>, it is fixed, provided it is not a participant class.<a href="#p_51" class="pid">51</a></p>
<h4 id="fork--intuition" class="refHeader"><code>fork</code> intuition<a aria-hidden="true" tabindex="-1" href="#fork--intuition"><span class="icon icon-link"></span></a></h4>
<p><i id="p_52" class="pid"></i>A fork statement is an abbreviation of a common <span class="snip"><span style="color: #24292F">race</span></span> and <span class="snip"><span style="color: #CF222E">switch</span></span> pattern you could write yourself.<a href="#p_52" class="pid">52</a></p>
<p>
  <i id="p_53" class="pid"></i>The idea is that each of the participants in the <span class="snip"><span style="color: #CF222E">case</span></span> components do an independent local step evaluation of a value they would like to <span class="snip"><span style="color: #24292F">publish</span></span> and then all <span class="snip"><span style="color: #24292F">race</span></span> to <span class="snip"><span style="color: #24292F">publish</span></span> their value.
  The one that "wins" the <span class="snip"><span style="color: #24292F">race</span></span> then determines not only the value (&amp; <span class="snip"><span style="color: #24292F">pay</span></span> expression), but also what consensus step code runs to consume the value.<a href="#p_53" class="pid">53</a>
</p>
<p><i id="p_54" class="pid"></i>The sample <span class="snip"><span style="color: #24292F">fork</span></span> statement linked to the <span class="snip"><span style="color: #24292F">fork</span></span> keyword is roughly equivalent to:<a href="#p_54" class="pid">54</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="// We first define a Data instance so that each participant can publish a
// different kind of value
const ForkData = Data({Alice: UInt, Bob: Null});
// Then we bind these values for each participant
Alice.only(() => {
 const fork_msg = ForkData.Alice(19);
 const fork_when = declassify(interact.keepGoing()); });
Bob.only(() => {
 const fork_msg = ForkData.Bob(null);
 const fork_when = declassify(interact.keepGoing()); });
// They race
race(Alice, Bob)
 .publish(fork_msg)
 .when(fork_when)
 // The pay ammount depends on who is publishing
 .pay(fork_msg.match( {
   Alice: (v => v),
   Bob: ((_) => wager) } ))
 // The timeout is always the same
 .timeout(deadline, () => {
   race(Alice, Bob).publish();
   transfer(wager).to(this);
   commit();
   exit(); });

 // We ensure that the correct participant published the correct kind of value
 require(fork_msg.match( {
   // Alice had previously published
   Alice: (v => this == Alice),
   // But Bob had not.
   Bob: ((_) => true) } ));

 // Then we select the appropriate body to run
 switch (fork_msg) {
   case Alice: {
     assert (this == Alice);
     require(v == 19);
     transfer(wager + 19).to(this);
     commit();
     exit(); }
   case Bob: {
     Bob.set(this);
     commit();

     Alice.only(() => interact.showOpponent(Bob));

     race(Alice, Bob).publish();
     transfer(2 * wager).to(this);
     commit();
     exit(); }
 }" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #6E7781">// We first define a Data instance so that each participant can publish a</span></li><li value="2"><span style="color: #6E7781">// different kind of value</span></li><li value="3"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ForkData</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Data</span><span style="color: #24292F">({Alice: UInt, Bob: Null});</span></li><li value="4"><span style="color: #6E7781">// Then we bind these values for each participant</span></li><li value="5"><span style="color: #24292F">Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="6"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">fork_msg</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> ForkData.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(</span><span style="color: #0550AE">19</span><span style="color: #24292F">);</span></li><li value="7"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">fork_when</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">keepGoing</span><span style="color: #24292F">()); });</span></li><li value="8"><span style="color: #24292F">Bob.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="9"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">fork_msg</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> ForkData.</span><span style="color: #8250DF">Bob</span><span style="color: #24292F">(</span><span style="color: #0550AE">null</span><span style="color: #24292F">);</span></li><li value="10"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">fork_when</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">declassify</span><span style="color: #24292F">(interact.</span><span style="color: #8250DF">keepGoing</span><span style="color: #24292F">()); });</span></li><li value="11"><span style="color: #6E7781">// They race</span></li><li value="12"><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob)</span></li><li value="13"><span style="color: #24292F"> .</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(fork_msg)</span></li><li value="14"><span style="color: #24292F"> .</span><span style="color: #8250DF">when</span><span style="color: #24292F">(fork_when)</span></li><li value="15"><span style="color: #24292F"> </span><span style="color: #6E7781">// The pay ammount depends on who is publishing</span></li><li value="16"><span style="color: #24292F"> .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(fork_msg.</span><span style="color: #8250DF">match</span><span style="color: #24292F">( {</span></li><li value="17"><span style="color: #24292F">   Alice: (</span><span style="color: #953800">v</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> v),</span></li><li value="18"><span style="color: #24292F">   Bob: ((</span><span style="color: #953800">_</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> wager) } ))</span></li><li value="19"><span style="color: #24292F"> </span><span style="color: #6E7781">// The timeout is always the same</span></li><li value="20"><span style="color: #24292F"> .</span><span style="color: #8250DF">timeout</span><span style="color: #24292F">(deadline, () </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="21"><span style="color: #24292F">   </span><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="22"><span style="color: #24292F">   </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="23"><span style="color: #24292F">   </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="24"><span style="color: #24292F">   </span><span style="color: #8250DF">exit</span><span style="color: #24292F">(); });</span></li><li value="25"></li><li value="26"><span style="color: #24292F"> </span><span style="color: #6E7781">// We ensure that the correct participant published the correct kind of value</span></li><li value="27"><span style="color: #24292F"> </span><span style="color: #0550AE">require</span><span style="color: #24292F">(fork_msg.</span><span style="color: #8250DF">match</span><span style="color: #24292F">( {</span></li><li value="28"><span style="color: #24292F">   </span><span style="color: #6E7781">// Alice had previously published</span></li><li value="29"><span style="color: #24292F">   Alice: (</span><span style="color: #953800">v</span><span style="color: #24292F"> </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F"> </span><span style="color: #CF222E">==</span><span style="color: #24292F"> Alice),</span></li><li value="30"><span style="color: #24292F">   </span><span style="color: #6E7781">// But Bob had not.</span></li><li value="31"><span style="color: #24292F">   Bob: ((</span><span style="color: #953800">_</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> </span><span style="color: #0550AE">true</span><span style="color: #24292F">) } ));</span></li><li value="32"></li><li value="33"><span style="color: #24292F"> </span><span style="color: #6E7781">// Then we select the appropriate body to run</span></li><li value="34"><span style="color: #24292F"> </span><span style="color: #CF222E">switch</span><span style="color: #24292F"> (fork_msg) {</span></li><li value="35"><span style="color: #24292F">   </span><span style="color: #CF222E">case</span><span style="color: #24292F"> Alice: {</span></li><li value="36"><span style="color: #24292F">     </span><span style="color: #8250DF">assert</span><span style="color: #24292F"> (</span><span style="color: #0550AE">this</span><span style="color: #24292F"> </span><span style="color: #CF222E">==</span><span style="color: #24292F"> Alice);</span></li><li value="37"><span style="color: #24292F">     </span><span style="color: #0550AE">require</span><span style="color: #24292F">(v </span><span style="color: #CF222E">==</span><span style="color: #24292F"> </span><span style="color: #0550AE">19</span><span style="color: #24292F">);</span></li><li value="38"><span style="color: #24292F">     </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(wager </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">19</span><span style="color: #24292F">).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="39"><span style="color: #24292F">     </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="40"><span style="color: #24292F">     </span><span style="color: #8250DF">exit</span><span style="color: #24292F">(); }</span></li><li value="41"><span style="color: #24292F">   </span><span style="color: #CF222E">case</span><span style="color: #24292F"> Bob: {</span></li><li value="42"><span style="color: #24292F">     Bob.</span><span style="color: #8250DF">set</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="43"><span style="color: #24292F">     </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="44"></li><li value="45"><span style="color: #24292F">     Alice.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> interact.</span><span style="color: #8250DF">showOpponent</span><span style="color: #24292F">(Bob));</span></li><li value="46"></li><li value="47"><span style="color: #24292F">     </span><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">();</span></li><li value="48"><span style="color: #24292F">     </span><span style="color: #8250DF">transfer</span><span style="color: #24292F">(</span><span style="color: #0550AE">2</span><span style="color: #24292F"> </span><span style="color: #CF222E">*</span><span style="color: #24292F"> wager).</span><span style="color: #8250DF">to</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="49"><span style="color: #24292F">     </span><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li><li value="50"><span style="color: #24292F">     </span><span style="color: #8250DF">exit</span><span style="color: #24292F">(); }</span></li><li value="51"><span style="color: #24292F"> }</span></li></ol></pre>
<p>
  <i id="p_55" class="pid"></i>This pattern is tedious to write and error-prone, so the <span class="snip"><span style="color: #24292F">fork</span></span> statement abbreviates it for Reach programmers.
  When a participant specifies multiple cases, the <code>msg</code> field of the participant will be wrapped with an additional
  variant signifying what case was chosen.<a href="#p_55" class="pid">55</a>
</p>
<h3 id="wait" class="refHeader"><code>wait</code><a aria-hidden="true" tabindex="-1" href="#wait"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_wait" data-scope="rsh" data-symbol="wait"></span></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="wait(TIME);" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">wait</span><span style="color: #24292F">(</span><span style="color: #0550AE">TIME</span><span style="color: #24292F">);</span></li></ol></pre>
<p>
  <i id="p_56" class="pid"></i>A <span class="term" id="term_wait%20statement">wait statement</span>, written <span class="snip"><span style="color: #8250DF">wait</span><span style="color: #24292F">(</span><span style="color: #0550AE">TIME</span><span style="color: #24292F">);</span></span>, delays the computation until the <span class="snip"><span style="color: #0550AE">TIME</span></span> time argument passes.
  <span class="snip"><span style="color: #0550AE">TIME</span></span> must be pure and only reference values known by the consensus state.
  It may only occur in a step.<a href="#p_56" class="pid">56</a>
</p>
<h3 id="exit" class="refHeader"><code>exit</code><a aria-hidden="true" tabindex="-1" href="#exit"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_exit" data-scope="rsh" data-symbol="exit"></span></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="exit();" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></li></ol></pre>
<p>
  <i id="p_57" class="pid"></i>An <span class="term" id="term_exit%20statement">exit statement</span>, written <span class="snip"><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></span>, halts the computation.
  It is a terminator statement, so it must have an empty tail.
  It may only occur in a step.<a href="#p_57" class="pid">57</a>
</p>
<h2 id="ref-programs-step-exprs" class="refHeader">Expressions<a aria-hidden="true" tabindex="-1" href="#ref-programs-step-exprs"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_58" class="pid"></i>Any expressions valid for a <a href="/rsh/compute/#ref-programs-compute-exprs">computation</a> are valid for a step.
  However, some additional expressions are allowed.<a href="#p_58" class="pid">58</a>
</p>
<h3 id="race" class="refHeader"><code>race</code><a aria-hidden="true" tabindex="-1" href="#race"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_race" data-scope="rsh" data-symbol="race"></span></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="race(Alice, Bob).publish(bet);" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">race</span><span style="color: #24292F">(Alice, Bob).</span><span style="color: #8250DF">publish</span><span style="color: #24292F">(bet);</span></li></ol></pre>
<div class="note">
  <p><i id="p_59" class="pid"></i>If you're unsure of what kind of consensus transfer to use, you may want to read the <a href="/guide/ctransfers/#guide-ctransfers">explanation of the differences</a> in the Guide.<a href="#p_59" class="pid">59</a></p>
</div>
<p><i id="p_60" class="pid"></i>A <span class="term" id="term_race%20expression">race expression</span>, written <span class="snip"><span style="color: #8250DF">race</span><span style="color: #24292F">(</span><span style="color: #0550AE">PARTICIPANT_0</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #24292F">, PARTICIPANT_n);</span></span>, constructs a participant that may be used in a consensus transfer statement, such as <span class="snip"><span style="color: #24292F">publish</span></span> or <span class="snip"><span style="color: #24292F">pay</span></span>, where the various participants race to be the first one to perform the consensus transfer.<a href="#p_60" class="pid">60</a></p>
<p><i id="p_61" class="pid"></i>Reach provides a shorthand, <span class="snip"><span style="color: #24292F">Anybody</span></span>, which serves as a <span class="snip"><span style="color: #24292F">race</span></span> between all the participants.<a href="#p_61" class="pid">61</a></p>
<div class="note">
  <p><i id="p_62" class="pid"></i>See <a href="/guide/race/#guide-race">the guide section on races</a> to understand the benefits and dangers of using <span class="snip"><span style="color: #24292F">race</span></span>.<a href="#p_62" class="pid">62</a></p>
</div>
<h3 id="unknowable" class="refHeader"><code>unknowable</code><a aria-hidden="true" tabindex="-1" href="#unknowable"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_unknowable" data-scope="rsh" data-symbol="unknowable"></span></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="unknowable( Notter, Knower(var_0, ..., var_N), [msg] )" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">unknowable</span><span style="color: #24292F">( Notter, </span><span style="color: #8250DF">Knower</span><span style="color: #24292F">(var_0, </span><span style="color: #CF222E">...</span><span style="color: #24292F">, var_N), [msg] )</span></li></ol></pre>
<p>
  <i id="p_63" class="pid"></i>A knowledge assertion that the participant <span class="snip"><span style="color: #24292F">Notter</span></span> <em>does not</em> know the results of the variables <span class="snip"><span style="color: #24292F">var_0</span></span> through <span class="snip"><span style="color: #24292F">var_N</span></span>, but that the participant <span class="snip"><span style="color: #24292F">Knower</span></span> <em>does</em> know those values.
  It accepts an optional bytes argument, which is included in any reported violation.<a href="#p_63" class="pid">63</a>
</p>
<h3 id="closeto" class="refHeader"><code>closeTo</code><a aria-hidden="true" tabindex="-1" href="#closeto"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_closeTo" data-scope="rsh" data-symbol="closeTo"></span></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="closeTo( Who, after, nonNetPayAmt )" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #8250DF">closeTo</span><span style="color: #24292F">( Who, after, nonNetPayAmt )</span></li></ol></pre>
<p>
  <i id="p_64" class="pid"></i>Has participant <span class="snip"><span style="color: #24292F">Who</span></span> make a publication, then transfer the <span class="snip"><span style="color: #8250DF">balance</span><span style="color: #24292F">()</span></span> and the non-network pay amount to <span class="snip"><span style="color: #24292F">Who</span></span> and end the DApp after executing the function <span class="snip"><span style="color: #24292F">after</span></span> in a step.
  The <span class="snip"><span style="color: #24292F">nonNetPayAmt</span></span> parameter should be a pay amount. For example, when closing a program that uses a <span class="snip"><span style="color: #24292F">Token</span></span> <span class="snip"><span style="color: #24292F">token</span></span>, the argument would be <span class="snip"><span style="color: #24292F">[ [</span><span style="color: #8250DF">balance</span><span style="color: #24292F">(tok), tok] ]</span></span>.
  The <span class="snip"><span style="color: #24292F">after</span></span> and <span class="snip"><span style="color: #24292F">nonNetPayAmt</span></span> arguments are optional.<a href="#p_64" class="pid">64</a>
</p>
<h3 id="call" class="refHeader"><code>call</code><a aria-hidden="true" tabindex="-1" href="#call"><span class="icon icon-link"></span></a></h3>
<p><span class="ref" id="rsh_call" data-scope="rsh" data-symbol="call"></span></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="const A = API('A', {
  isGt: Fun([UInt, UInt], Bool);
});
// ...
const [ dom, k ] =
  call(A.isGt).assume((x, y) => x != y)
              .pay((x, y) => x);
const [x, y] = dom;
k(x > y);
commit();" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">A</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">API</span><span style="color: #24292F">(</span><span style="color: #0A3069">'A'</span><span style="color: #24292F">, {</span></li><li value="2"><span style="color: #24292F">  isGt: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">([UInt, UInt], Bool);</span></li><li value="3"><span style="color: #24292F">});</span></li><li value="4"><span style="color: #6E7781">// ...</span></li><li value="5"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">dom</span><span style="color: #24292F">, </span><span style="color: #0550AE">k</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span></li><li value="6"><span style="color: #24292F">  </span><span style="color: #8250DF">call</span><span style="color: #24292F">(</span><span style="color: #0550AE">A</span><span style="color: #24292F">.isGt).</span><span style="color: #8250DF">assume</span><span style="color: #24292F">((</span><span style="color: #953800">x</span><span style="color: #24292F">, </span><span style="color: #953800">y</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> x </span><span style="color: #CF222E">!=</span><span style="color: #24292F"> y)</span></li><li value="7"><span style="color: #24292F">              .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">((</span><span style="color: #953800">x</span><span style="color: #24292F">, </span><span style="color: #953800">y</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> x);</span></li><li value="8"><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">x</span><span style="color: #24292F">, </span><span style="color: #0550AE">y</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> dom;</span></li><li value="9"><span style="color: #8250DF">k</span><span style="color: #24292F">(x </span><span style="color: #CF222E">&gt;</span><span style="color: #24292F"> y);</span></li><li value="10"><span style="color: #8250DF">commit</span><span style="color: #24292F">();</span></li></ol></pre>
<p><i id="p_65" class="pid"></i>A <span class="term" id="term_call">call</span> is written:<a href="#p_65" class="pid">65</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="const [ DOMAIN, RET_FUN ] =
  call(API_EXPR)
    .pay(API_PAY_EXPR)
    .assume(API_ASSUME_EXPR)
    .throwTimeout(DELAY_EXPR, THROW_EXPR)" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #CF222E">const</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">DOMAIN</span><span style="color: #24292F">, </span><span style="color: #0550AE">RET_FUN</span><span style="color: #24292F"> ] </span><span style="color: #CF222E">=</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #8250DF">call</span><span style="color: #24292F">(</span><span style="color: #0550AE">API_EXPR</span><span style="color: #24292F">)</span></li><li value="3"><span style="color: #24292F">    .</span><span style="color: #8250DF">pay</span><span style="color: #24292F">(</span><span style="color: #0550AE">API_PAY_EXPR</span><span style="color: #24292F">)</span></li><li value="4"><span style="color: #24292F">    .</span><span style="color: #8250DF">assume</span><span style="color: #24292F">(</span><span style="color: #0550AE">API_ASSUME_EXPR</span><span style="color: #24292F">)</span></li><li value="5"><span style="color: #24292F">    .</span><span style="color: #8250DF">throwTimeout</span><span style="color: #24292F">(</span><span style="color: #0550AE">DELAY_EXPR</span><span style="color: #24292F">, </span><span style="color: #0550AE">THROW_EXPR</span><span style="color: #24292F">)</span></li></ol></pre>
<p><i id="p_66" class="pid"></i>where:<a href="#p_66" class="pid">66</a></p>
<ul>
  <li><i id="p_67" class="pid"></i><code>DOMAIN</code> is the the domain of the API member function.<a href="#p_67" class="pid">67</a></li>
  <li><i id="p_68" class="pid"></i><code>RET_FUN</code> is a function that returns a value to the API call. This function must be called.<a href="#p_68" class="pid">68</a></li>
  <li><i id="p_69" class="pid"></i><code>API_EXPR</code> is an expression that evaluates to an API member function.<a href="#p_69" class="pid">69</a></li>
  <li>
    <i id="p_70" class="pid"></i><code>API_PAY_EXPR</code>, <code>API_ASSUME_EXPR</code>, and <span class="snip"><span style="color: #24292F">throwTimeout</span></span> are like the corresponding parts in a <span class="snip"><span style="color: #24292F">fork</span></span> statement.
    They are optional.<a href="#p_70" class="pid">70</a>
  </li>
</ul>
<p>
  <i id="p_71" class="pid"></i><span class="snip"><span style="color: #24292F">call</span></span> will call the given API member function, returning a pair, <span class="snip"><span style="color: #24292F">[</span><span style="color: #0550AE">DOMAIN</span><span style="color: #24292F">, </span><span style="color: #0550AE">RET_FUN</span><span style="color: #24292F">]</span></span>.
  <span class="snip"><span style="color: #24292F">call</span></span> will publish the domain of the API member function, transferring the program from
  a step to consensus step.<a href="#p_71" class="pid">71</a>
</p>