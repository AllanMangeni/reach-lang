<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5.5.2&nbsp;Conflux</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewselflink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="ref-install.html" class="tocviewlink" data-pltdoc="x">Installation</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="ref-usage.html" class="tocviewlink" data-pltdoc="x">Usage</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="ref-model.html" class="tocviewlink" data-pltdoc="x">Language Model</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="ref-programs.html" class="tocviewlink" data-pltdoc="x">Programs</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="ref-networks.html" class="tocviewselflink" data-pltdoc="x">Consensus Network Connectors</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="ref-backends.html" class="tocviewlink" data-pltdoc="x">Participant Backends</a></td></tr><tr><td align="right">5.7&nbsp;</td><td><a href="ref-frontends.html" class="tocviewlink" data-pltdoc="x">Frontend Support</a></td></tr><tr><td align="right">5.8&nbsp;</td><td><a href="ref-error-codes.html" class="tocviewlink" data-pltdoc="x">Error Codes</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>5.5&nbsp;</td><td><a href="ref-networks.html" class="tocviewlink" data-pltdoc="x">Consensus Network Connectors</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.5.1&nbsp;</td><td><a href="ref-network-algo.html" class="tocviewlink" data-pltdoc="x">Algorand</a></td></tr><tr><td align="right">5.5.2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Conflux</a></td></tr><tr><td align="right">5.5.3&nbsp;</td><td><a href="ref-network-eth.html" class="tocviewlink" data-pltdoc="x">Ethereum</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_3&quot;);">&#9658;</a></td><td>5.5.2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Conflux</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_3"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.5.2.1&nbsp;</td><td><a href="#%28part._cfx-faq%29" class="tocviewlink" data-pltdoc="x">FAQ</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><a href="#%28env._.C.F.X_.N.O.D.E_.U.R.I%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">CFX_<span class="mywbr"> &nbsp;</span>NODE_<span class="mywbr"> &nbsp;</span>URI</span></a></td></tr><tr><td><a href="#%28env._.C.F.X_.N.E.T.W.O.R.K_.I.D%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">CFX_<span class="mywbr"> &nbsp;</span>NETWORK_<span class="mywbr"> &nbsp;</span>ID</span></a></td></tr><tr><td><span class="tocsublinknumber">5.5.2.1<tt>&nbsp;</tt></span><a href="#%28part._cfx-faq%29" class="tocsubseclink" data-pltdoc="x">FAQ</a></td></tr><tr><td><span class="tocsublinknumber">5.5.2.1.1<tt>&nbsp;</tt></span><a href="#%28part._cfx-faq-mainnet%29" class="tocsubseclink" data-pltdoc="x">How do I run my Reach DApp on CFX Test<span class="mywbr"> &nbsp;</span>Net or Main<span class="mywbr"> &nbsp;</span>Net?</a></td></tr><tr><td><span class="tocsublinknumber">5.5.2.1.2<tt>&nbsp;</tt></span><a href="#%28part._cfx-faq-cplocal%29" class="tocsubseclink" data-pltdoc="x">How can I use Conflux<span class="mywbr"> &nbsp;</span>Portal with the Reach devnet?</a></td></tr><tr><td><span class="tocsublinknumber">5.5.2.1.3<tt>&nbsp;</tt></span><a href="#%28part._cfx-faq-sponsor%29" class="tocsubseclink" data-pltdoc="x">How can I use gas and storage sponsorship?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="ref-network-algo.html" title="backward to &quot;5.5.1 Algorand&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="ref-networks.html" title="up to &quot;5.5 Consensus Network Connectors&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ref-network-eth.html" title="forward to &quot;5.5.3 Ethereum&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h5>5.5.2<tt>&nbsp;</tt><a name="(part._ref-network-cfx)"></a>Conflux</h5><p>The <a href="https://confluxnetwork.org/">Conflux</a> Reach <a href="ref-model.html#%28tech._connector%29" class="techoutside" data-pltdoc="x"><span class="techinside">connector</span></a> works almost identically to the <a href="ref-network-eth.html" data-pltdoc="x">Ethereum connector</a>, except that it behaves differently at runtime: using, for example, <a href="https://portal.confluxnetwork.org/">Conflux Portal</a> rather than <a href="https://metamask.io/">MetaMask</a>, and connecting to Conflux nodes.</p><p><a href="ref-model.html#%28tech._backend%29" class="techoutside" data-pltdoc="x"><span class="techinside">Backends</span></a> must respect the following environment variables:</p><ul><li><p><a name="(env._.C.F.X_.N.O.D.E_.U.R.I)"></a><a name="(idx._(gentag._386))"></a><span class="stt">CFX_NODE_URI</span> is used to contact the Conflux node.
It defaults to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">http://localhost:12537</span><span class="hspace"></span></span>.</p></li><li><p><a name="(env._.C.F.X_.N.E.T.W.O.R.K_.I.D)"></a><a name="(idx._(gentag._387))"></a><span class="stt">CFX_NETWORK_ID</span> is used to determine the Conflux network id.
It defaults to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">999</span><span class="hspace"></span></span>.</p></li></ul><h5>5.5.2.1<tt>&nbsp;</tt><a name="(part._cfx-faq)"></a>FAQ</h5><h5>5.5.2.1.1<tt>&nbsp;</tt><a name="(part._cfx-faq-mainnet)"></a>How do I run my Reach DApp on CFX TestNet or MainNet?</h5><p>You can add the following JavaScript near the beginning of your index.js or index.mjs file
in order to run on Conflux TestNet:</p><p><div class="highlight"><pre><span></span><font class="badlink"><span class="nx">reach</span></font><span class="p">.</span><a href="ref-frontends-js-provider.html#%28javascript._%28%28set.Provider.By.Name%29%29%29" class="nx" data-pltdoc="x">setProviderByName</a><span class="p">(</span><span class="s1">&#39;TestNet&#39;</span><span class="p">);</span>
</pre></div></p><p>Or this to run on Conflux MainNet:</p><p><div class="highlight"><pre><span></span><font class="badlink"><span class="nx">reach</span></font><span class="p">.</span><a href="ref-frontends-js-provider.html#%28javascript._%28%28set.Provider.By.Name%29%29%29" class="nx" data-pltdoc="x">setProviderByName</a><span class="p">(</span><span class="s1">&#39;MainNet&#39;</span><span class="p">);</span>
</pre></div></p><h5>5.5.2.1.2<tt>&nbsp;</tt><a name="(part._cfx-faq-cplocal)"></a>How can I use ConfluxPortal with the Reach devnet?</h5><p>If you find that ConfluxPortal&rsquo;s Localhost 12537 default configuration does not work correctly with Reach apps,
you can try configuring ConfluxPortal to use a custom RPC endpoint:</p><ul><li><p>Click the network dropdown in Conflux Portal</p></li><li><p>Select: Custom RPC</p></li><li><p>Use RPC url: http://127.0.0.1:12537</p></li></ul><p>If your locally-running Conflux devnet restarts,
you may find that you need to reset ConfluxPortal&rsquo;s account history,
which you can do like so:</p><ul><li><p>Select the desired account</p></li><li><p>Click the profile image of the account (top-right)</p></li><li><p>Click Settings &gt; Advanced &gt; Reset Account &gt; (confirm) Reset</p></li><li><p>Switch to a different network and back</p></li><li><p>CTRL+SHIFT+R to hard-reset the webpage.</p></li></ul><h5>5.5.2.1.3<tt>&nbsp;</tt><a name="(part._cfx-faq-sponsor)"></a>How can I use gas and storage sponsorship?</h5><p>Conflux, like many other networks, charges fees for using the network and interacting with smart contracts.
These fees are normally pay by the originator the transaction: who we would call the "publisher" in Reach.
However, unlike other networks, Conflux does not require these fees to be paid for by the originator.
Instead, Conflux allows fees to be paid for by a third-party.
This is called "sponsorship".</p><p>Conflux maintains documentation for this feature on their <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/">internal contract</a> documentation page.
You can follow the directions on the Conflux page exactly and it will work with Reach, because Reach programs, when deployed on Conflux, are just normal programs.</p><p>We duplicate these instructions below; if you have any difficulties with these directions, please refer to the <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/">Conflux source</a> and then let us know, so we can update them.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>There are three steps to enabling sponsorship.</p><p>First, you have to directly interact with <a href="https://github.com/Conflux-Chain/js-conflux-sdk">the Conflux SDK</a>.
This will require adding an <span class="stt">npm</span> package dependency and initializing the library.
The <a href="https://confluxnetwork.gitbook.io/js-conflux-sdk/quick_start">Conflux SDK Quickstart</a> walks through this process.
It will look something like:
<div class="highlight"><pre><span></span><span class="c1">// import Conflux Class</span>
<font class="badlink"><span class="kd">const</span></font> <span class="p">{</span> <font class="badlink"><span class="nx">Conflux</span></font> <span class="p">}</span> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">require</span></font><span class="p">(</span><span class="s1">&#39;js-conflux-sdk&#39;</span><span class="p">);</span>
<span class="c1">// initialize a Conflux object</span>
<font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">conflux</span></font> <font class="badlink"><span class="o">=</span></font> <span class="ow">new</span> <font class="badlink"><span class="nx">Conflux</span></font><span class="p">({</span>
  <span class="c1">// some options</span>
<span class="p">});</span>
</pre></div></p><p>Second, you must call the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">addPrivilegeByAdmin</span><span class="hspace"></span></span> Conflux internal contract from the creator (i.e. deployer) of the smart contract.
This function requires you to provide an address that is eligible for sponsorship.
It is documented in <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/#whitelist-maintenance">this section</a> of the Conflux manual.
If you use an address which is all zeros, then every address is sponsored.
The code will look something like:
<div class="highlight"><pre><span></span><font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">sponsor_contract</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nx">conflux</span></font><span class="p">.</span><font class="badlink"><span class="nx">InternalContract</span></font><span class="p">(</span><span class="s1">&#39;SponsorWhitelistControl&#39;</span><span class="p">);</span>
<font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">sponsor_contract</span></font><span class="p">.</span><font class="badlink"><span class="nx">addPrivilegeByAdmin</span></font><span class="p">(</span><font class="badlink"><span class="nx">contractAddress</span></font><span class="p">,</span> <span class="p">[</span><span class="s2">"0x0000000000000000000000000000000000000000"</span><span class="p">])</span>
  <span class="p">.</span><font class="badlink"><span class="nx">sendTransaction</span></font><span class="p">({</span><font class="badlink"><span class="kr">from</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">creatorAddress</span></font><span class="p">});</span>
</pre></div>
In this code sample, we assume that <code class="highlight"><font class="badlink"><span class="nx">contractAddress</span></font></code> is the address of the Reach contract, which you might have acquired via <code class="highlight"><font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">ctc</span></font><span class="p">.</span><a href="ref-frontends-js-ctc.html#%28javascript._%28%28get.Contract.Address%29%29%29" class="nx" data-pltdoc="x">getContractAddress</a><span class="p">()</span></code> and <code class="highlight"><font class="badlink"><span class="nx">creatorAddress</span></font></code> is the address of the creator of the Reach contract.</p><p>Third, you have to provide a sponsoring account by calling <span class="RktInBG"><span class="hspace"></span><span class="RktIn">setSponsorForGas</span><span class="hspace"></span></span> (or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">setSponsorForCollateral</span><span class="hspace"></span></span>) on the Conflux internal contract.
This function must be called by the sponsoring account.
It is documented in <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/#add-sponsor-balance">this section</a> of the Conflux manual.
The code will look something like:
<div class="highlight"><pre><span></span><font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">sponsor_contract</span></font><span class="p">.</span><font class="badlink"><span class="nx">setSponsorForGas</span></font><span class="p">(</span><font class="badlink"><span class="nx">contractAddress</span></font><span class="p">,</span> <font class="badlink"><span class="nx">amount</span></font><span class="p">)</span>
  <span class="p">.</span><font class="badlink"><span class="nx">sendTransaction</span></font><span class="p">({</span><font class="badlink"><span class="kr">from</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="nx">sponsorAddress</span></font><span class="p">});</span>
</pre></div>
In this code sample, we assume that <code class="highlight"><font class="badlink"><span class="nx">contractAddress</span></font></code> is the address of the Reach contract, which you might have acquired via <code class="highlight"><font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">ctc</span></font><span class="p">.</span><a href="ref-frontends-js-ctc.html#%28javascript._%28%28get.Contract.Address%29%29%29" class="nx" data-pltdoc="x">getContractAddress</a><span class="p">()</span></code>, <code class="highlight"><font class="badlink"><span class="nx">amount</span></font></code> is the maximum amount the sponsor is willing to sponsor, and <code class="highlight"><font class="badlink"><span class="nx">sponsorAddress</span></font></code> is the address of the sponsor.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>If your application is made of equal peers, you may not want to enable the sponsorship feature.
But, if your application has a clear party with extra authority and resources, you might like to make them the creator and sponsor of the contract, because this incentivizes participation in the program by lowering the cost to do so.</p><p>As of November 2021, the Conflux Foundation is willing to sponsor some smart contracts.
<a href="https://forum.conflux.fun/t/announcement-usage-adjustment-of-ecosystem-fund-for-the-conflux-sponsorship-mechanism-2022-11-11/12056">This forum post</a> discusses how to request sponsorship of your contract.
If the Foundation agrees to sponsor your program, then you only need to do steps one and two above: you can skip step three.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="ref-network-algo.html" title="backward to &quot;5.5.1 Algorand&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="ref-networks.html" title="up to &quot;5.5 Consensus Network Connectors&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="ref-network-eth.html" title="forward to &quot;5.5.3 Ethereum&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>