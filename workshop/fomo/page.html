<p>
  <i id="p_0" class="pid"></i>In this workshop, we'll design an application that allows a Funder
  to create an auction where participants may purchase tickets.
  The Funder sets a ticket price and a relative deadline. When
  a Buyer purchases a ticket, the deadline is reset. Whoever is the
  last person to buy a ticket—when the deadline finally hits—wins
  the entire balance. This program is based off of the crypto game,
  <a href="https://fomo3d.hostedwiki.co/">FOMO3DGame</a>.<a href="#p_0" class="pid">0</a>
</p>
<p><i id="p_1" class="pid"></i>This workshop utilizes participant classes to represent Buyers, which allows us to handle multiple participants in a generic way.<a href="#p_1" class="pid">1</a></p>
<div class="note">
  <p><i id="p_2" class="pid"></i>This workshop is independent of all others.<a href="#p_2" class="pid">2</a></p>
</div>
<p><i id="p_3" class="pid"></i>We assume that you'll go through this workshop in a directory named <code>~/reach/workshop-fomo</code>:<a href="#p_3" class="pid">3</a></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="$ mkdir -p ~/reach/workshop-fomo &amp;&amp; cd ~/reach/workshop-fomo" href="#"></a></div><ol class="snippet"><li value="1">$ mkdir -p ~/reach/workshop-fomo &amp;&amp; cd ~/reach/workshop-fomo</li></ol></pre>
<p><i id="p_4" class="pid"></i>And that you have a copy of Reach <a href="/tool/install/#ref-install">installed</a> in <code>~/reach</code> so you can write<a href="#p_4" class="pid">4</a></p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="$ ../reach version" href="#"></a></div><ol class="snippet"><li value="1">$ ../reach version</li></ol></pre>
<p>
  <i id="p_5" class="pid"></i>And it will run Reach.
  You should start off by initializing your Reach program:<a href="#p_5" class="pid">5</a>
</p>
<pre class="snippet unnumbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="$ ../reach init" href="#"></a></div><ol class="snippet"><li value="1">$ ../reach init</li></ol></pre>
<h2 id="workshop-fomo-pr" class="refHeader">Problem Analysis<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-pr"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_6" class="pid"></i>First, we should think over the details of the application and
  answer some questions to help reason about the implementation of
  the program.<a href="#p_6" class="pid">6</a>
</p>
<p>
  <i id="p_7" class="pid"></i>You should write the answer to the following questions in your
  Reach program (<code>index.rsh</code>) using a comment.
  <span class="snip"><span style="color: #6A737D">/* Remember comments are written like this. */</span></span><a href="#p_7" class="pid">7</a>
</p>
<ul>
  <li><i id="p_8" class="pid"></i>Who is involved in this application?<a href="#p_8" class="pid">8</a></li>
  <li><i id="p_9" class="pid"></i>What information do they know at the start of the program?<a href="#p_9" class="pid">9</a></li>
  <li>
    <i id="p_10" class="pid"></i>What information are they going to discover and use
    in the program?<a href="#p_10" class="pid">10</a>
  </li>
  <li><i id="p_11" class="pid"></i>What funds change ownership during the application and how?<a href="#p_11" class="pid">11</a></li>
</ul>
<p><strong>Write down the problem analysis of this program as a comment.</strong></p>
<p><i id="p_12" class="pid"></i>Let's see how your answers compare to ours:<a href="#p_12" class="pid">12</a></p>
<ul>
  <li>
    <i id="p_13" class="pid"></i>This program involves two parties: a Funder who deploys the
    auction and the Buyers who purchase tickets.<a href="#p_13" class="pid">13</a>
  </li>
  <li>
    <i id="p_14" class="pid"></i>The Funder knows the deadline and the ticket price at the
    start of the application.<a href="#p_14" class="pid">14</a>
  </li>
  <li><i id="p_15" class="pid"></i>The Buyers do not know anything of the deadline or ticket price when the application begins.<a href="#p_15" class="pid">15</a></li>
  <li><i id="p_16" class="pid"></i>The Funder does not learn anything during the program execution.<a href="#p_16" class="pid">16</a></li>
  <li>
    <i id="p_17" class="pid"></i>The Buyers learn of the ticket price and deadline during the
    program execution.<a href="#p_17" class="pid">17</a>
  </li>
  <li><i id="p_18" class="pid"></i>Buyers continually add funds to the balance during execution until one Buyer wins the entire balance.<a href="#p_18" class="pid">18</a></li>
</ul>
<p><i id="p_19" class="pid"></i>It's okay if some of your answers differ from ours!<a href="#p_19" class="pid">19</a></p>
<h2 id="workshop-fomo-dd" class="refHeader">Data Definition<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-dd"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_20" class="pid"></i>After problem analysis, we need to decide how we will represent the information
  in the program:<a href="#p_20" class="pid">20</a>
</p>
<ul>
  <li><i id="p_21" class="pid"></i>What data type will represent the deadline set by the Funder?<a href="#p_21" class="pid">21</a></li>
  <li><i id="p_22" class="pid"></i>What data type will represent the ticket price set by the Funder?<a href="#p_22" class="pid">22</a></li>
  <li><i id="p_23" class="pid"></i>What data type will represent the Buyer's decision to purchase a ticket?<a href="#p_23" class="pid">23</a></li>
</ul>
<div class="note">
  <p><i id="p_24" class="pid"></i>Refer to <a href="/rsh/compute/#ref-programs-types">Types</a> for a reminder of what data types are available in Reach.<a href="#p_24" class="pid">24</a></p>
</div>
<p><i id="p_25" class="pid"></i>Now that we've decided what data types to use, we need to determine how the programs will obtain this information. We need to outline the participant interact interface for each participant.<a href="#p_25" class="pid">25</a></p>
<ul>
  <li><i id="p_26" class="pid"></i>What participant interact interface will Funder use?<a href="#p_26" class="pid">26</a></li>
  <li><i id="p_27" class="pid"></i>What participant interact interface will Buyer use?<a href="#p_27" class="pid">27</a></li>
</ul>
<p>
  <i id="p_28" class="pid"></i>Revisit the problem analysis section when completing this section. Whenever
  a participant starts off with some knowledge, that will be a field in the
  <span class="snip"><span style="color: #24292E">interact</span></span> object.
  If they learn something, then it will be an argument to a function.
  If they provide something later, then it will be the result of a function.<a href="#p_28" class="pid">28</a>
</p>
<p><i id="p_29" class="pid"></i>You should write your answers in your Reach file (<code>index.rsh</code>) as the participant interact interface for each of the participants.<a href="#p_29" class="pid">29</a></p>
<p><strong>Write down the data definitions for this program as definitions.</strong></p>
<p><i id="p_30" class="pid"></i>Let's compare your answers with ours:<a href="#p_30" class="pid">30</a></p>
<ul>
  <li>
    <i id="p_31" class="pid"></i>The deadline will be represented with a <span class="snip"><span style="color: #24292E">UInt</span></span>, as it is
    a relative time delta signifying a change in block numbers.<a href="#p_31" class="pid">31</a>
  </li>
  <li><i id="p_32" class="pid"></i>The <code>ticketPrice</code> will be represented with a <span class="snip"><span style="color: #24292E">UInt</span></span><a href="#p_32" class="pid">32</a></li>
  <li><i id="p_33" class="pid"></i>The decision to buy a ticket will be represented by a function <span class="snip"><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool)</span></span><a href="#p_33" class="pid">33</a></li>
</ul>
<p><i id="p_34" class="pid"></i>Our participant interact interface, with the addition of some handy logging functions, looks like this so far:<a href="#p_34" class="pid">34</a></p>
<pre class="snippet numbered"><div class="codeHeader"><a href="https://github.com/reach-sh/reach-lang/tree/master/examples/workshop-fomo/index.rsh">/examples/workshop-fomo/index.rsh</a><a class="far fa-copy copyBtn" data-clipboard-text="'reach 0.1';
'use strict';

const CommonInterface = {
  // Show the address of winner
  showOutcome: Fun([Address], Null),
};

const FunderInterface = {
  ...CommonInterface,
  getParams: Fun([], Object({
    // relative deadline
    deadline: UInt,
    ticketPrice: UInt,
  })),
};

const BuyerInterface = {
  ...CommonInterface,
  shouldBuyTicket: Fun([UInt], Bool),
  showPurchase: Fun([Address], Null),
};

export const main = Reach.App(
  { },
  [
    Participant('Funder', FunderInterface),
    ParticipantClass('Buyer', BuyerInterface),
  ],
  (Funder, Buyer) => {

    // Helper to display results to everyone
    const showOutcome = (who) =>
      each([Funder, Buyer], () => {
        interact.showOutcome(who); });

    // Have the funder publish the ticket price and deadline
    Funder.only(() => {
      const { ticketPrice, deadline } =
        declassify(interact.getParams());
    });
    Funder.publish(ticketPrice, deadline);

    // Until timeout, allow buyers to buy ticket
    const [ keepGoing, winner, ticketsSold ] =
      parallelReduce([ true, Funder, 0 ])
        .invariant(balance() == ticketsSold * ticketPrice)
        .while(keepGoing)
        .case(
          Buyer,
          () => ({
            when: declassify(interact.shouldBuyTicket(ticketPrice)),
          }),
          (_) => ticketPrice,
          (_) => {
            const buyer = this;
            Buyer.only(() => interact.showPurchase(buyer));
            return [ true, buyer, ticketsSold + 1 ];
          }
        )
        .timeout(relativeTime(deadline), () => {
          Anybody.publish();
          return [ false, winner, ticketsSold ]; });

    // Whoever buys last wins and receives balance
    transfer(balance()).to(winner);
    commit();
    showOutcome(winner);
  });" href="#"></a></div><ol class="snippet"><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">CommonInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6A737D">// Show the address of winner</span></li><li value="6"><span style="color: #24292E">  showOutcome: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([Address], Null),</span></li><li value="7"><span style="color: #24292E">};</span></li><li value="8"></li><li value="9"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">FunderInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">CommonInterface,</span></li><li value="11"><span style="color: #24292E">  getParams: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], </span><span style="color: #005CC5">Object</span><span style="color: #24292E">({</span></li><li value="12"><span style="color: #24292E">    </span><span style="color: #6A737D">// relative deadline</span></li><li value="13"><span style="color: #24292E">    deadline: UInt,</span></li><li value="14"><span style="color: #24292E">    ticketPrice: UInt,</span></li><li value="15"><span style="color: #24292E">  })),</span></li><li value="16"><span style="color: #24292E">};</span></li><li value="17"></li><li value="18"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">BuyerInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="19"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">CommonInterface,</span></li><li value="20"><span style="color: #24292E">  shouldBuyTicket: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool),</span></li><li value="21"><span style="color: #24292E">  showPurchase: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([Address], Null),</span></li><li value="22"><span style="color: #24292E">};</span></li></ol></pre>
<p>
  <i id="p_35" class="pid"></i>At this point, you can modify your JavaScript file (<code>index.mjs</code>) to contain definitions of these values, although you may want to use placeholders for the actual values.
  When you're writing a Reach program, especially in the early phases, you should have these two files open side-by-side and update them in tandem as you're deciding the participant interact interface.<a href="#p_35" class="pid">35</a>
</p>
<h2 id="workshop-fomo-cc" class="refHeader">Communication Construction<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-cc"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_36" class="pid"></i>A fundamental aspect of a decentralized application is the pattern of communication
  and transfer among the participants. We should write down this structure as comments
  in our program to serve as an outline and guide us in implementation.
  For example, for the <a href="/tut/rps/#tut">tutorial</a> version of <em>Rock, Paper, Scissors!</em>, we might write:<a href="#p_36" class="pid">36</a>
</p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="// Alice publishes the wager and pays it
// Bob accepts the wager and pays it
// While there's a draw
//  Alice publishes her hand secretly
//  Bob publishes his hand publicly
//  Alice reveals her hand
//  The consensus ensures it's the same hand as before
// The consensus pays out the wager" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #6A737D">// Alice publishes the wager and pays it</span></li><li value="2"><span style="color: #6A737D">// Bob accepts the wager and pays it</span></li><li value="3"><span style="color: #6A737D">// While there's a draw</span></li><li value="4"><span style="color: #6A737D">//  Alice publishes her hand secretly</span></li><li value="5"><span style="color: #6A737D">//  Bob publishes his hand publicly</span></li><li value="6"><span style="color: #6A737D">//  Alice reveals her hand</span></li><li value="7"><span style="color: #6A737D">//  The consensus ensures it's the same hand as before</span></li><li value="8"><span style="color: #6A737D">// The consensus pays out the wager</span></li></ol></pre>
<p><i id="p_37" class="pid"></i>You should do this now, in your Reach program (<code>index.rsh</code>).<a href="#p_37" class="pid">37</a></p>
<p><strong>Write down the communication pattern for this program as comments.</strong></p>
<p><i id="p_38" class="pid"></i>Here's what we wrote for our outline:<a href="#p_38" class="pid">38</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="// 1. The Funder publishes the ticket price and deadline
// 2. While the deadline has yet to be reached:
//     2a. Allow a Buyer to purchase a ticket
//     2b. Keep track of last Buyer
// 3. Transfer the balance to the last person who bought a ticket" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #6A737D">// 1. The Funder publishes the ticket price and deadline</span></li><li value="2"><span style="color: #6A737D">// 2. While the deadline has yet to be reached:</span></li><li value="3"><span style="color: #6A737D">//     2a. Allow a Buyer to purchase a ticket</span></li><li value="4"><span style="color: #6A737D">//     2b. Keep track of last Buyer</span></li><li value="5"><span style="color: #6A737D">// 3. Transfer the balance to the last person who bought a ticket</span></li></ol></pre>
<p><i id="p_39" class="pid"></i>Now, this outline needs to be converted to a real program.<a href="#p_39" class="pid">39</a></p>
<p><strong>Write down the communication pattern for this program as code.</strong></p>
<p><i id="p_40" class="pid"></i>The body of your application should look something like this:<a href="#p_40" class="pid">40</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="// 1. The Funder publishes the ticket price and deadline
Funder.publish(ticketPrice, deadline);

const [ keepGoing, winner, ticketsSold ] =
  // 2. While the deadline has yet to be reached
  parallelReduce([ true, Funder, 0 ])
    .invariant(balance() == ticketsSold * ticketPrice)
    .while(keepGoing)
    .case(
      Buyer,
      // 2a. Allow a Buyer to purchase a ticket
      (() => ({
        when: declassify(interact.shouldBuyTicket(ticketPrice)),
      })),
      (() => ticketPrice),
      (() => {
        const buyer = this;
        Buyer.only(() => interact.showPurchase(buyer));
        // 2b. Keep track of last Buyer
        return [ true, buyer, ticketsSold + 1 ];
      })
    )
    .timeout(deadline, () => {
      race(Buyer, Funder).publish();
      return [ false, winner, ticketsSold ]; });

// 3. Transfer the balance to the last person who bought a ticket
transfer(balance()).to(winner);
commit();" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #6A737D">// 1. The Funder publishes the ticket price and deadline</span></li><li value="2"><span style="color: #24292E">Funder.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(ticketPrice, deadline);</span></li><li value="3"></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">keepGoing</span><span style="color: #24292E">, </span><span style="color: #005CC5">winner</span><span style="color: #24292E">, </span><span style="color: #005CC5">ticketsSold</span><span style="color: #24292E"> ] </span><span style="color: #D73A49">=</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6A737D">// 2. While the deadline has yet to be reached</span></li><li value="6"><span style="color: #24292E">  </span><span style="color: #6F42C1">parallelReduce</span><span style="color: #24292E">([ </span><span style="color: #005CC5">true</span><span style="color: #24292E">, Funder, </span><span style="color: #005CC5">0</span><span style="color: #24292E"> ])</span></li><li value="7"><span style="color: #24292E">    .</span><span style="color: #6F42C1">invariant</span><span style="color: #24292E">(</span><span style="color: #6F42C1">balance</span><span style="color: #24292E">() </span><span style="color: #D73A49">==</span><span style="color: #24292E"> ticketsSold </span><span style="color: #D73A49">*</span><span style="color: #24292E"> ticketPrice)</span></li><li value="8"><span style="color: #24292E">    .</span><span style="color: #6F42C1">while</span><span style="color: #24292E">(keepGoing)</span></li><li value="9"><span style="color: #24292E">    .</span><span style="color: #6F42C1">case</span><span style="color: #24292E">(</span></li><li value="10"><span style="color: #24292E">      Buyer,</span></li><li value="11"><span style="color: #24292E">      </span><span style="color: #6A737D">// 2a. Allow a Buyer to purchase a ticket</span></li><li value="12"><span style="color: #24292E">      (() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="13"><span style="color: #24292E">        when: </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">shouldBuyTicket</span><span style="color: #24292E">(ticketPrice)),</span></li><li value="14"><span style="color: #24292E">      })),</span></li><li value="15"><span style="color: #24292E">      (() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ticketPrice),</span></li><li value="16"><span style="color: #24292E">      (() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="17"><span style="color: #24292E">        </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyer</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></li><li value="18"><span style="color: #24292E">        Buyer.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">showPurchase</span><span style="color: #24292E">(buyer));</span></li><li value="19"><span style="color: #24292E">        </span><span style="color: #6A737D">// 2b. Keep track of last Buyer</span></li><li value="20"><span style="color: #24292E">        </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">true</span><span style="color: #24292E">, buyer, ticketsSold </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> ];</span></li><li value="21"><span style="color: #24292E">      })</span></li><li value="22"><span style="color: #24292E">    )</span></li><li value="23"><span style="color: #24292E">    .</span><span style="color: #6F42C1">timeout</span><span style="color: #24292E">(deadline, () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="24"><span style="color: #24292E">      </span><span style="color: #6F42C1">race</span><span style="color: #24292E">(Buyer, Funder).</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li><li value="25"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">false</span><span style="color: #24292E">, winner, ticketsSold ]; });</span></li><li value="26"></li><li value="27"><span style="color: #6A737D">// 3. Transfer the balance to the last person who bought a ticket</span></li><li value="28"><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(</span><span style="color: #6F42C1">balance</span><span style="color: #24292E">()).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(winner);</span></li><li value="29"><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li></ol></pre>
<p>
  <i id="p_41" class="pid"></i>We use <span class="snip"><span style="color: #24292E">parallelReduce</span></span> to allow Buyers to purchase tickets until
  the deadline passes and accumulate the current winner. We maintain the invariant
  that the balance must be equal to the number of tickets sold multiplied by the
  ticket price.<a href="#p_41" class="pid">41</a>
</p>
<h2 id="workshop-fomo-ai" class="refHeader">Assertion Insertion<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-ai"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_42" class="pid"></i>This program doesn't have many interesting properties to prove
  as assertions, beyond the token linearity property. The
  only property of interest is the <span class="snip"><span style="color: #24292E">parallelReduce</span></span> invariant
  which states that the balance must be equal to the number of tickets
  sold multiplied by the ticket price.<a href="#p_42" class="pid">42</a>
</p>
<h2 id="workshop-fomo-ii" class="refHeader">Interaction Introduction<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-ii"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_43" class="pid"></i>Next, we need to insert the appropriate calls to <span class="snip"><span style="color: #24292E">interact</span></span>.
  In this case, our program is very simple and we expect you'll do a great job without further discussion.<a href="#p_43" class="pid">43</a>
</p>
<p><strong>Insert <code>interact</code> calls to the frontend into the program.</strong></p>
<p><i id="p_44" class="pid"></i>Let's look at our whole program now:<a href="#p_44" class="pid">44</a></p>
<pre class="snippet numbered"><div class="codeHeader"><a href="https://github.com/reach-sh/reach-lang/tree/master/examples/workshop-fomo/index.rsh">/examples/workshop-fomo/index.rsh</a><a class="far fa-copy copyBtn" data-clipboard-text="'reach 0.1';
'use strict';

const CommonInterface = {
  // Show the address of winner
  showOutcome: Fun([Address], Null),
};

const FunderInterface = {
  ...CommonInterface,
  getParams: Fun([], Object({
    // relative deadline
    deadline: UInt,
    ticketPrice: UInt,
  })),
};

const BuyerInterface = {
  ...CommonInterface,
  shouldBuyTicket: Fun([UInt], Bool),
  showPurchase: Fun([Address], Null),
};

export const main = Reach.App(
  { },
  [
    Participant('Funder', FunderInterface),
    ParticipantClass('Buyer', BuyerInterface),
  ],
  (Funder, Buyer) => {

    // Helper to display results to everyone
    const showOutcome = (who) =>
      each([Funder, Buyer], () => {
        interact.showOutcome(who); });

    // Have the funder publish the ticket price and deadline
    Funder.only(() => {
      const { ticketPrice, deadline } =
        declassify(interact.getParams());
    });
    Funder.publish(ticketPrice, deadline);

    // Until timeout, allow buyers to buy ticket
    const [ keepGoing, winner, ticketsSold ] =
      parallelReduce([ true, Funder, 0 ])
        .invariant(balance() == ticketsSold * ticketPrice)
        .while(keepGoing)
        .case(
          Buyer,
          () => ({
            when: declassify(interact.shouldBuyTicket(ticketPrice)),
          }),
          (_) => ticketPrice,
          (_) => {
            const buyer = this;
            Buyer.only(() => interact.showPurchase(buyer));
            return [ true, buyer, ticketsSold + 1 ];
          }
        )
        .timeout(relativeTime(deadline), () => {
          Anybody.publish();
          return [ false, winner, ticketsSold ]; });

    // Whoever buys last wins and receives balance
    transfer(balance()).to(winner);
    commit();
    showOutcome(winner);
  });" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #032F62">'reach 0.1'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #032F62">'use strict'</span><span style="color: #24292E">;</span></li><li value="3"></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">CommonInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="5"><span style="color: #24292E">  </span><span style="color: #6A737D">// Show the address of winner</span></li><li value="6"><span style="color: #24292E">  showOutcome: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([Address], Null),</span></li><li value="7"><span style="color: #24292E">};</span></li><li value="8"></li><li value="9"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">FunderInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="10"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">CommonInterface,</span></li><li value="11"><span style="color: #24292E">  getParams: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([], </span><span style="color: #005CC5">Object</span><span style="color: #24292E">({</span></li><li value="12"><span style="color: #24292E">    </span><span style="color: #6A737D">// relative deadline</span></li><li value="13"><span style="color: #24292E">    deadline: UInt,</span></li><li value="14"><span style="color: #24292E">    ticketPrice: UInt,</span></li><li value="15"><span style="color: #24292E">  })),</span></li><li value="16"><span style="color: #24292E">};</span></li><li value="17"></li><li value="18"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">BuyerInterface</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="19"><span style="color: #24292E">  </span><span style="color: #D73A49">...</span><span style="color: #24292E">CommonInterface,</span></li><li value="20"><span style="color: #24292E">  shouldBuyTicket: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([UInt], Bool),</span></li><li value="21"><span style="color: #24292E">  showPurchase: </span><span style="color: #6F42C1">Fun</span><span style="color: #24292E">([Address], Null),</span></li><li value="22"><span style="color: #24292E">};</span></li><li value="23"></li><li value="24"><span style="color: #D73A49">export</span><span style="color: #24292E"> </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">main</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> Reach.</span><span style="color: #6F42C1">App</span><span style="color: #24292E">(</span></li><li value="25"><span style="color: #24292E">  { },</span></li><li value="26"><span style="color: #24292E">  [</span></li><li value="27"><span style="color: #24292E">    </span><span style="color: #6F42C1">Participant</span><span style="color: #24292E">(</span><span style="color: #032F62">'Funder'</span><span style="color: #24292E">, FunderInterface),</span></li><li value="28"><span style="color: #24292E">    </span><span style="color: #6F42C1">ParticipantClass</span><span style="color: #24292E">(</span><span style="color: #032F62">'Buyer'</span><span style="color: #24292E">, BuyerInterface),</span></li><li value="29"><span style="color: #24292E">  ],</span></li><li value="30"><span style="color: #24292E">  (</span><span style="color: #E36209">Funder</span><span style="color: #24292E">, </span><span style="color: #E36209">Buyer</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="31"></li><li value="32"><span style="color: #24292E">    </span><span style="color: #6A737D">// Helper to display results to everyone</span></li><li value="33"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #6F42C1">showOutcome</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> (</span><span style="color: #E36209">who</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span></li><li value="34"><span style="color: #24292E">      </span><span style="color: #6F42C1">each</span><span style="color: #24292E">([Funder, Buyer], () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="35"><span style="color: #24292E">        interact.</span><span style="color: #6F42C1">showOutcome</span><span style="color: #24292E">(who); });</span></li><li value="36"></li><li value="37"><span style="color: #24292E">    </span><span style="color: #6A737D">// Have the funder publish the ticket price and deadline</span></li><li value="38"><span style="color: #24292E">    Funder.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="39"><span style="color: #24292E">      </span><span style="color: #D73A49">const</span><span style="color: #24292E"> { </span><span style="color: #005CC5">ticketPrice</span><span style="color: #24292E">, </span><span style="color: #005CC5">deadline</span><span style="color: #24292E"> } </span><span style="color: #D73A49">=</span></li><li value="40"><span style="color: #24292E">        </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">getParams</span><span style="color: #24292E">());</span></li><li value="41"><span style="color: #24292E">    });</span></li><li value="42"><span style="color: #24292E">    Funder.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">(ticketPrice, deadline);</span></li><li value="43"></li><li value="44"><span style="color: #24292E">    </span><span style="color: #6A737D">// Until timeout, allow buyers to buy ticket</span></li><li value="45"><span style="color: #24292E">    </span><span style="color: #D73A49">const</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">keepGoing</span><span style="color: #24292E">, </span><span style="color: #005CC5">winner</span><span style="color: #24292E">, </span><span style="color: #005CC5">ticketsSold</span><span style="color: #24292E"> ] </span><span style="color: #D73A49">=</span></li><li value="46"><span style="color: #24292E">      </span><span style="color: #6F42C1">parallelReduce</span><span style="color: #24292E">([ </span><span style="color: #005CC5">true</span><span style="color: #24292E">, Funder, </span><span style="color: #005CC5">0</span><span style="color: #24292E"> ])</span></li><li value="47"><span style="color: #24292E">        .</span><span style="color: #6F42C1">invariant</span><span style="color: #24292E">(</span><span style="color: #6F42C1">balance</span><span style="color: #24292E">() </span><span style="color: #D73A49">==</span><span style="color: #24292E"> ticketsSold </span><span style="color: #D73A49">*</span><span style="color: #24292E"> ticketPrice)</span></li><li value="48"><span style="color: #24292E">        .</span><span style="color: #6F42C1">while</span><span style="color: #24292E">(keepGoing)</span></li><li value="49"><span style="color: #24292E">        .</span><span style="color: #6F42C1">case</span><span style="color: #24292E">(</span></li><li value="50"><span style="color: #24292E">          Buyer,</span></li><li value="51"><span style="color: #24292E">          () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ({</span></li><li value="52"><span style="color: #24292E">            when: </span><span style="color: #6F42C1">declassify</span><span style="color: #24292E">(interact.</span><span style="color: #6F42C1">shouldBuyTicket</span><span style="color: #24292E">(ticketPrice)),</span></li><li value="53"><span style="color: #24292E">          }),</span></li><li value="54"><span style="color: #24292E">          (</span><span style="color: #E36209">_</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> ticketPrice,</span></li><li value="55"><span style="color: #24292E">          (</span><span style="color: #E36209">_</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="56"><span style="color: #24292E">            </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">buyer</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">this</span><span style="color: #24292E">;</span></li><li value="57"><span style="color: #24292E">            Buyer.</span><span style="color: #6F42C1">only</span><span style="color: #24292E">(() </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> interact.</span><span style="color: #6F42C1">showPurchase</span><span style="color: #24292E">(buyer));</span></li><li value="58"><span style="color: #24292E">            </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">true</span><span style="color: #24292E">, buyer, ticketsSold </span><span style="color: #D73A49">+</span><span style="color: #24292E"> </span><span style="color: #005CC5">1</span><span style="color: #24292E"> ];</span></li><li value="59"><span style="color: #24292E">          }</span></li><li value="60"><span style="color: #24292E">        )</span></li><li value="61"><span style="color: #24292E">        .</span><span style="color: #6F42C1">timeout</span><span style="color: #24292E">(</span><span style="color: #6F42C1">relativeTime</span><span style="color: #24292E">(deadline), () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="62"><span style="color: #24292E">          Anybody.</span><span style="color: #6F42C1">publish</span><span style="color: #24292E">();</span></li><li value="63"><span style="color: #24292E">          </span><span style="color: #D73A49">return</span><span style="color: #24292E"> [ </span><span style="color: #005CC5">false</span><span style="color: #24292E">, winner, ticketsSold ]; });</span></li><li value="64"></li><li value="65"><span style="color: #24292E">    </span><span style="color: #6A737D">// Whoever buys last wins and receives balance</span></li><li value="66"><span style="color: #24292E">    </span><span style="color: #6F42C1">transfer</span><span style="color: #24292E">(</span><span style="color: #6F42C1">balance</span><span style="color: #24292E">()).</span><span style="color: #6F42C1">to</span><span style="color: #24292E">(winner);</span></li><li value="67"><span style="color: #24292E">    </span><span style="color: #6F42C1">commit</span><span style="color: #24292E">();</span></li><li value="68"><span style="color: #24292E">    </span><span style="color: #6F42C1">showOutcome</span><span style="color: #24292E">(winner);</span></li><li value="69"><span style="color: #24292E">  });</span></li></ol></pre>
<h2 id="workshop-fomo-de" class="refHeader">Deployment Decisions<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-de"><span class="icon icon-link"></span></a></h2>
<p>
  <i id="p_45" class="pid"></i>Next, it is time to test our program. As usual, we'll present a completely
  automated test deployment, rather than an interactive one.<a href="#p_45" class="pid">45</a>
</p>
<p>
  <i id="p_46" class="pid"></i>The program is fairly straightfoward to test. We just create test accounts for
  the Funder and any number of Buyers. The decision to purchase a ticket by
  a Buyer will rely simply on generating a random boolean.<a href="#p_46" class="pid">46</a>
</p>
<p><strong>Decide how you will deploy and use this application.</strong></p>
<p><i id="p_47" class="pid"></i>Here's the JavaScript frontend we wrote:<a href="#p_47" class="pid">47</a></p>
<pre class="snippet numbered"><div class="codeHeader"><a href="https://github.com/reach-sh/reach-lang/tree/master/examples/workshop-fomo/index.mjs">/examples/workshop-fomo/index.mjs</a><a class="far fa-copy copyBtn" data-clipboard-text="import {loadStdlib} from '@reach-sh/stdlib';
import * as backend from './build/index.main.mjs';

const numOfBuyers = 10;

(async () => {
  const stdlib = await loadStdlib();
  const startingBalance = stdlib.parseCurrency(100);

  const accFunder = await stdlib.newTestAccount(startingBalance);
  const accBuyerArray = await Promise.all(
    Array.from({ length: numOfBuyers }, () =>
      stdlib.newTestAccount(startingBalance)
    )
  );

  const ctcFunder = accFunder.deploy(backend);
  const ctcInfo   = ctcFunder.getInfo();

  const funderParams = {
    ticketPrice: stdlib.parseCurrency(5),
    deadline: 5,
  };

  await Promise.all([
    backend.Funder(ctcFunder, {
      showOutcome: (addr) => console.log(`Funder saw ${stdlib.formatAddress(addr)} won.`),
      getParams: () => funderParams,
    }),
  ].concat(
    accBuyerArray.map((accBuyer, i) => {
      const ctcBuyer = accBuyer.attach(backend, ctcInfo);
      return backend.Buyer(ctcBuyer, {
        showOutcome: (outcome) => {
          console.log(`Buyer ${i} saw they ${stdlib.addressEq(outcome, accBuyer) ? 'won' : 'lost'}.`);
        },
        shouldBuyTicket : () => Math.random() < 0.5,
        showPurchase: (addr) => {
          if (stdlib.addressEq(addr, accBuyer)) {
            console.log(`Buyer ${i} bought a ticket.`);
          }
        }
      });
    })
  ));

})();" href="#"></a></div><ol class="snippet"><li value="1"><span style="color: #D73A49">import</span><span style="color: #24292E"> {loadStdlib} </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'@reach-sh/stdlib'</span><span style="color: #24292E">;</span></li><li value="2"><span style="color: #D73A49">import</span><span style="color: #24292E"> </span><span style="color: #005CC5">*</span><span style="color: #24292E"> </span><span style="color: #D73A49">as</span><span style="color: #24292E"> backend </span><span style="color: #D73A49">from</span><span style="color: #24292E"> </span><span style="color: #032F62">'./build/index.main.mjs'</span><span style="color: #24292E">;</span></li><li value="3"></li><li value="4"><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">numOfBuyers</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #005CC5">10</span><span style="color: #24292E">;</span></li><li value="5"></li><li value="6"><span style="color: #24292E">(</span><span style="color: #D73A49">async</span><span style="color: #24292E"> () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="7"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">stdlib</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #6F42C1">loadStdlib</span><span style="color: #24292E">();</span></li><li value="8"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">startingBalance</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">100</span><span style="color: #24292E">);</span></li><li value="9"></li><li value="10"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">accFunder</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(startingBalance);</span></li><li value="11"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">accBuyerArray</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">all</span><span style="color: #24292E">(</span></li><li value="12"><span style="color: #24292E">    </span><span style="color: #005CC5">Array</span><span style="color: #24292E">.</span><span style="color: #6F42C1">from</span><span style="color: #24292E">({ length: numOfBuyers }, () </span><span style="color: #D73A49">=&gt;</span></li><li value="13"><span style="color: #24292E">      stdlib.</span><span style="color: #6F42C1">newTestAccount</span><span style="color: #24292E">(startingBalance)</span></li><li value="14"><span style="color: #24292E">    )</span></li><li value="15"><span style="color: #24292E">  );</span></li><li value="16"></li><li value="17"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcFunder</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> accFunder.</span><span style="color: #6F42C1">deploy</span><span style="color: #24292E">(backend);</span></li><li value="18"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcInfo</span><span style="color: #24292E">   </span><span style="color: #D73A49">=</span><span style="color: #24292E"> ctcFunder.</span><span style="color: #6F42C1">getInfo</span><span style="color: #24292E">();</span></li><li value="19"></li><li value="20"><span style="color: #24292E">  </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">funderParams</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> {</span></li><li value="21"><span style="color: #24292E">    ticketPrice: stdlib.</span><span style="color: #6F42C1">parseCurrency</span><span style="color: #24292E">(</span><span style="color: #005CC5">5</span><span style="color: #24292E">),</span></li><li value="22"><span style="color: #24292E">    deadline: </span><span style="color: #005CC5">5</span><span style="color: #24292E">,</span></li><li value="23"><span style="color: #24292E">  };</span></li><li value="24"></li><li value="25"><span style="color: #24292E">  </span><span style="color: #D73A49">await</span><span style="color: #24292E"> </span><span style="color: #005CC5">Promise</span><span style="color: #24292E">.</span><span style="color: #6F42C1">all</span><span style="color: #24292E">([</span></li><li value="26"><span style="color: #24292E">    backend.</span><span style="color: #6F42C1">Funder</span><span style="color: #24292E">(ctcFunder, {</span></li><li value="27"><span style="color: #24292E">      </span><span style="color: #6F42C1">showOutcome</span><span style="color: #24292E">: (</span><span style="color: #E36209">addr</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Funder saw ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">formatAddress</span><span style="color: #032F62">(</span><span style="color: #24292E">addr</span><span style="color: #032F62">)</span><span style="color: #032F62">} won.`</span><span style="color: #24292E">),</span></li><li value="28"><span style="color: #24292E">      </span><span style="color: #6F42C1">getParams</span><span style="color: #24292E">: () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> funderParams,</span></li><li value="29"><span style="color: #24292E">    }),</span></li><li value="30"><span style="color: #24292E">  ].</span><span style="color: #6F42C1">concat</span><span style="color: #24292E">(</span></li><li value="31"><span style="color: #24292E">    accBuyerArray.</span><span style="color: #6F42C1">map</span><span style="color: #24292E">((</span><span style="color: #E36209">accBuyer</span><span style="color: #24292E">, </span><span style="color: #E36209">i</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="32"><span style="color: #24292E">      </span><span style="color: #D73A49">const</span><span style="color: #24292E"> </span><span style="color: #005CC5">ctcBuyer</span><span style="color: #24292E"> </span><span style="color: #D73A49">=</span><span style="color: #24292E"> accBuyer.</span><span style="color: #6F42C1">attach</span><span style="color: #24292E">(backend, ctcInfo);</span></li><li value="33"><span style="color: #24292E">      </span><span style="color: #D73A49">return</span><span style="color: #24292E"> backend.</span><span style="color: #6F42C1">Buyer</span><span style="color: #24292E">(ctcBuyer, {</span></li><li value="34"><span style="color: #24292E">        </span><span style="color: #6F42C1">showOutcome</span><span style="color: #24292E">: (</span><span style="color: #E36209">outcome</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="35"><span style="color: #24292E">          console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Buyer ${</span><span style="color: #24292E">i</span><span style="color: #032F62">} saw they ${</span><span style="color: #24292E">stdlib</span><span style="color: #032F62">.</span><span style="color: #6F42C1">addressEq</span><span style="color: #032F62">(</span><span style="color: #24292E">outcome</span><span style="color: #032F62">, </span><span style="color: #24292E">accBuyer</span><span style="color: #032F62">) </span><span style="color: #D73A49">?</span><span style="color: #032F62"> </span><span style="color: #032F62">'won'</span><span style="color: #032F62"> </span><span style="color: #D73A49">:</span><span style="color: #032F62"> </span><span style="color: #032F62">'lost'}.`</span><span style="color: #24292E">);</span></li><li value="36"><span style="color: #24292E">        },</span></li><li value="37"><span style="color: #24292E">        </span><span style="color: #6F42C1">shouldBuyTicket</span><span style="color: #24292E"> : () </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">Math</span><span style="color: #24292E">.</span><span style="color: #005CC5">random</span><span style="color: #24292E">() </span><span style="color: #D73A49">&lt;</span><span style="color: #24292E"> </span><span style="color: #005CC5">0.5</span><span style="color: #24292E">,</span></li><li value="38"><span style="color: #24292E">        </span><span style="color: #6F42C1">showPurchase</span><span style="color: #24292E">: (</span><span style="color: #E36209">addr</span><span style="color: #24292E">) </span><span style="color: #D73A49">=&gt;</span><span style="color: #24292E"> {</span></li><li value="39"><span style="color: #24292E">          </span><span style="color: #D73A49">if</span><span style="color: #24292E"> (stdlib.</span><span style="color: #6F42C1">addressEq</span><span style="color: #24292E">(addr, accBuyer)) {</span></li><li value="40"><span style="color: #24292E">            console.</span><span style="color: #6F42C1">log</span><span style="color: #24292E">(</span><span style="color: #032F62">`Buyer ${</span><span style="color: #24292E">i</span><span style="color: #032F62">} bought a ticket.`</span><span style="color: #24292E">);</span></li><li value="41"><span style="color: #24292E">          }</span></li><li value="42"><span style="color: #24292E">        }</span></li><li value="43"><span style="color: #24292E">      });</span></li><li value="44"><span style="color: #24292E">    })</span></li><li value="45"><span style="color: #24292E">  ));</span></li><li value="46"></li><li value="47"><span style="color: #24292E">})();</span></li></ol></pre>
<p><i id="p_48" class="pid"></i>Let's see what it looks like when we run the program:<a href="#p_48" class="pid">48</a></p>
<pre class="snippet numbered"><div class="codeHeader">&nbsp;<a class="far fa-copy copyBtn" data-clipboard-text="$ ../reach run
Buyer 0 bought a ticket.
Buyer 3 bought a ticket.
...
Buyer 5 bought a ticket.
Buyer 9 bought a ticket.
Buyer 1 bought a ticket.
Funder saw 0x94CAC1b24C1f7b0EBAD4A51797dE5d59A39910C4 won.
Buyer 5 saw they lost.
Buyer 1 saw they won.
Buyer 6 saw they lost.
Buyer 0 saw they lost.
Buyer 4 saw they lost.
Buyer 8 saw they lost.
Buyer 2 saw they lost.
Buyer 7 saw they lost.
Buyer 3 saw they lost.
Buyer 9 saw they lost." href="#"></a></div><ol class="snippet"><li value="1">$ ../reach run</li><li value="2">Buyer 0 bought a ticket.</li><li value="3">Buyer 3 bought a ticket.</li><li value="4">...</li><li value="5">Buyer 5 bought a ticket.</li><li value="6">Buyer 9 bought a ticket.</li><li value="7">Buyer 1 bought a ticket.</li><li value="8">Funder saw 0x94CAC1b24C1f7b0EBAD4A51797dE5d59A39910C4 won.</li><li value="9">Buyer 5 saw they lost.</li><li value="10">Buyer 1 saw they won.</li><li value="11">Buyer 6 saw they lost.</li><li value="12">Buyer 0 saw they lost.</li><li value="13">Buyer 4 saw they lost.</li><li value="14">Buyer 8 saw they lost.</li><li value="15">Buyer 2 saw they lost.</li><li value="16">Buyer 7 saw they lost.</li><li value="17">Buyer 3 saw they lost.</li><li value="18">Buyer 9 saw they lost.</li></ol></pre>
<h2 id="workshop-fomo-dns" class="refHeader">Discussion and Next Steps<a aria-hidden="true" tabindex="-1" href="#workshop-fomo-dns"><span class="icon icon-link"></span></a></h2>
<p><i id="p_49" class="pid"></i>Great job!<a href="#p_49" class="pid">49</a></p>
<p><i id="p_50" class="pid"></i>If you found this workshop rewarding, please let us know on <a href="https://discord.gg/AZsgcXu">the Discord community</a>!<a href="#p_50" class="pid">50</a></p>
<p>
  <i id="p_51" class="pid"></i>If you'd like to make this application a little more interesting, maybe you'd like
  to extend this program to make the last <code>N</code> buyers split the winnings. Check out
  <a href="/workshop/fomo-generalized/#workshop-fomo-generalized">Fear of Missing Out Generalized</a> for
  our solution!<a href="#p_51" class="pid">51</a>
</p>