<p>This article shows you how to pay the gas and storage fees on behalf of participants that visit a Reach smart contract deployed on the Conflux MainNet or TestNet. You do this by adding the Reach contract information to the Conflux internal <em>SponsorControl</em> contract. For more information about Conflux internal contracts, see the <a href="https://developer.confluxnetwork.org/conflux-rust/internal_contract/internal_contract/">Internal Contract</a> page on the <a href="https://developer.confluxnetwork.org/">Conflux Developer Portal</a>.</p>
<ol>
  <li>
    <p>Open the JavaScript file (e.g. <em>index.js</em> or <em>index.mjs</em>) associated with your webapp.</p>
  </li>
  <li>
    <p>Add the follow lines after your existing imports:</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">const</span><span style="color: #24292F"> {</span><span style="color: #0550AE">Conflux</span><span style="color: #24292F">} </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">require</span><span style="color: #24292F">(</span><span style="color: #0A3069">'js-conflux-sdk'</span><span style="color: #24292F">);</span></li><li value="2"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">cfx</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">new</span><span style="color: #24292F"> </span><span style="color: #8250DF">Conflux</span><span style="color: #24292F">({</span></li><li value="3"><span style="color: #24292F">  url: </span><span style="color: #0A3069">'https://test.confluxrpc.com'</span><span style="color: #24292F">,</span></li><li value="4"><span style="color: #24292F">  logger: console,</span></li><li value="5"><span style="color: #24292F">  networkId: </span><span style="color: #0550AE">1</span><span style="color: #24292F">,</span></li><li value="6"><span style="color: #24292F">});</span></li><li value="7"><span style="color: #24292F">cfx.provider </span><span style="color: #CF222E">=</span><span style="color: #24292F"> window.conflux;</span></li></ol></pre>
    <ul>
      <li>Line 1: Import the <a href="https://github.com/Conflux-Chain/js-conflux-sdk">Conflux JavaScript Library</a>.</li>
      <li>Line 2: Instantiate a Conflux object.</li>
      <li>Line 7: Set <code>provider</code> to the <a href="https://portal.confluxnetwork.org/">ConfluxPortal</a> user's address.</li>
    </ul>
  </li>
  <li>
    <p>Add the following lines after a participant deploys the Reach contract (within an <code>async</code> scope):</p>
    <pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">sponsor_contract</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> cfx.</span><span style="color: #8250DF">InternalContract</span><span style="color: #24292F">(</span><span style="color: #0A3069">'SponsorWhitelistControl'</span><span style="color: #24292F">);</span></li><li value="2"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcInfo</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> ctc.</span><span style="color: #8250DF">getContractAddress</span><span style="color: #24292F">();</span></li><li value="3"><span style="color: #CF222E">await</span><span style="color: #24292F"> sponsor_contract.</span><span style="color: #8250DF">addPrivilegeByAdmin</span><span style="color: #24292F">(ctcInfo, [</span><span style="color: #0A3069">"0x0000000000000000000000000000000000000000"</span><span style="color: #24292F">])</span></li><li value="4"><span style="color: #24292F">  .</span><span style="color: #8250DF">sendTransaction</span><span style="color: #24292F">({from: reach.</span><span style="color: #8250DF">formatAddress</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc),</span></li><li value="5"><span style="color: #24292F">});</span></li></ol></pre>
    <ul>
      <li>Line 1: Get a reference to the Conflux internal <em>SponsorWhitelistControl</em> contract.</li>
      <li>Line 2: Get the contract information of your Reach contract.</li>
      <li>Line 3: Sponsor all addresses in the array (or, in this case, all addresses).</li>
      <li>Line 4: Send a transaction signed by ConfluxPortal. <code>addPrivilegeByAdmin</code> returns the address of the initiator.</li>
    </ul>
  </li>
</ol>
<p>Below is an example from <a href="https://github.com/reach-sh/reach-lang/tree/master/examples/rps-9-web">Tutorial 9</a>:</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #24292F">async </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">() {</span></li><li value="2"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctc</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc.</span><span style="color: #8250DF">deploy</span><span style="color: #24292F">(backend);</span></li><li value="3"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'Deploying'</span><span style="color: #24292F">, ctc});</span></li><li value="4"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.wager </span><span style="color: #CF222E">=</span><span style="color: #24292F"> reach.</span><span style="color: #8250DF">parseCurrency</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.state.wager); </span></li><li value="5"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.deadline </span><span style="color: #CF222E">=</span><span style="color: #24292F"> {ETH: </span><span style="color: #0550AE">10</span><span style="color: #24292F">, ALGO: </span><span style="color: #0550AE">100</span><span style="color: #24292F">, CFX: </span><span style="color: #0550AE">1000</span><span style="color: #24292F">}[reach.connector]; </span></li><li value="6"><span style="color: #24292F">    backend.</span><span style="color: #8250DF">Alice</span><span style="color: #24292F">(ctc, </span><span style="color: #0550AE">this</span><span style="color: #24292F">);</span></li><li value="7"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">sponsor_contract</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> cfx.</span><span style="color: #8250DF">InternalContract</span><span style="color: #24292F">(</span><span style="color: #0A3069">'SponsorWhitelistControl'</span><span style="color: #24292F">);</span></li><li value="8"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcInfo</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #CF222E">await</span><span style="color: #24292F"> ctc.</span><span style="color: #8250DF">getContractAddress</span><span style="color: #24292F">();</span></li><li value="9"><span style="color: #24292F">    </span><span style="color: #CF222E">await</span><span style="color: #24292F"> sponsor_contract.</span><span style="color: #8250DF">addPrivilegeByAdmin</span><span style="color: #24292F">(ctcInfo, [</span><span style="color: #0A3069">"0x0000000000000000000000000000000000000000"</span><span style="color: #24292F">]).</span><span style="color: #8250DF">sendTransaction</span><span style="color: #24292F">({</span></li><li value="10"><span style="color: #24292F">      from: reach.</span><span style="color: #8250DF">formatAddress</span><span style="color: #24292F">(</span><span style="color: #0550AE">this</span><span style="color: #24292F">.props.acc),</span></li><li value="11"><span style="color: #24292F">    });</span></li><li value="12"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">ctcInfoStr</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">JSON</span><span style="color: #24292F">.</span><span style="color: #0550AE">stringify</span><span style="color: #24292F">(</span><span style="color: #CF222E">await</span><span style="color: #24292F"> ctc.</span><span style="color: #8250DF">getInfo</span><span style="color: #24292F">(), </span><span style="color: #0550AE">null</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F">);</span></li><li value="13"><span style="color: #24292F">    </span><span style="color: #0550AE">this</span><span style="color: #24292F">.</span><span style="color: #8250DF">setState</span><span style="color: #24292F">({view: </span><span style="color: #0A3069">'WaitingForAttacher'</span><span style="color: #24292F">, ctcInfoStr});</span></li><li value="14"><span style="color: #24292F">  }</span></li></ol></pre>