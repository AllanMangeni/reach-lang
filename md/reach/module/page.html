<p>
  A Reach <span id="term_source%20file">source file</span> is a textual file which specifies a Reach module.
  It is traditionally given the file extension <code>rsh</code>,
  e.g. <code>dao.rsh</code>.
</p>
<p>
  A <span id="term_module">module</span> starts with <code>'reach reach-short-vers';</code>
  followed by a sequence of imports and identifier definitions.
</p>
<div class="note">
  <p>See <a href="/md/guide/versions/#guide-versions">the guide section on versions</a> to understand how Reach uses version numbers like this.</p>
</div>
<h2 id="ref-programs-module-stmts">Statements<a aria-hidden="true" tabindex="-1" href="#ref-programs-module-stmts"><span class="icon icon-link"></span></a></h2>
<p>
  Any statements valid for a <a href="/md/reach/compute/#ref-programs-compute-stmts">computation</a> are valid for a module.
  However, some additional statements are allowed.
</p>
<h3 id="ref-programs-export"><code>export</code><a aria-hidden="true" tabindex="-1" href="#ref-programs-export"><span class="icon icon-link"></span></a></h3>
<p>
  Module-level identifier definitions may be <span id="term_export">export</span>ed
  by writing <span id="rsh_export"></span><code>export</code> in front of them.
  For example,
</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">x</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> [</span><span style="color: #0550AE">a</span><span style="color: #24292F">, </span><span style="color: #0550AE">b</span><span style="color: #24292F">, </span><span style="color: #CF222E">...</span><span style="color: #0550AE">more</span><span style="color: #24292F">] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> [ </span><span style="color: #0550AE">0</span><span style="color: #24292F">, </span><span style="color: #0550AE">1</span><span style="color: #24292F">, </span><span style="color: #0550AE">2</span><span style="color: #24292F">, </span><span style="color: #0550AE">3</span><span style="color: #24292F">, </span><span style="color: #0550AE">4</span><span style="color: #24292F"> ];</span></li><li value="3"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">function</span><span style="color: #24292F"> </span><span style="color: #8250DF">add1</span><span style="color: #24292F">(</span><span style="color: #953800">x</span><span style="color: #24292F">) { </span><span style="color: #CF222E">return</span><span style="color: #24292F"> x </span><span style="color: #CF222E">+</span><span style="color: #24292F"> </span><span style="color: #0550AE">1</span><span style="color: #24292F">; };</span></li></ol></pre>
<p>are valid exports.</p>
<p>
  Module-level identifiers may also be exported after the fact,
  and may be renamed during export. For example:
</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">w</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">2</span><span style="color: #24292F">;</span></li><li value="2"><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">z</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">export</span><span style="color: #24292F"> {w, z </span><span style="color: #CF222E">as</span><span style="color: #24292F"> zero};</span></li></ol></pre>
<p>
  Identifiers from other modules may be re-exported (and renamed),
  even if they are not imported in the current module.
  For example:
</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">export</span><span style="color: #24292F"> {u, x </span><span style="color: #CF222E">as</span><span style="color: #24292F"> other_x} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'./other-module.rsh'</span><span style="color: #24292F">;</span></li></ol></pre>
<p>An exported identifier in a given module may be imported by other modules.</p>
<p>
  Exports are also exposed to the frontend via <code>getExports</code>. Functions are only exposed
  if they are typed, that is, if they are constructed with <code>is</code>.
</p>
<h3 id="ref-programs-import"><code>import</code><a aria-hidden="true" tabindex="-1" href="#ref-programs-import"><span class="icon icon-link"></span></a></h3>
<p>
  <span id="rsh_import"></span>Reach supports two types of module <span id="term_imports">imports</span>: local imports,
  which refer to modules that exist within your project, and
  package imports, which refer to remote libraries that may be fetched
  from external sources such as <a href="https://github.com">GitHub</a>.
</p>
<div class="note">
  <p>Read <a href="/md/guide/packages/#guide-packages">the guide section on packages</a> for more details.</p>
</div>
<p>
  Package imports are easily distinguished from local imports by a
  mandatory <code>@</code> character at the beginning of the path string.
</p>
<h4 id="ref-programs-import-local">Local imports<a aria-hidden="true" tabindex="-1" href="#ref-programs-import-local"><span class="icon icon-link"></span></a></h4>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0A3069">'games-of-chance.rsh'</span><span style="color: #24292F">;</span></li></ol></pre>
<p>
  When a module, <code>X</code>, contains a <span id="term_local%20import">local import</span>,
  written <code>import "LIB.rsh";</code>,
  then the path <code>LIB.rsh</code> must resolve to another Reach source file.
  The exports from the module defined by <code>LIB.rsh</code> are included in the set of bound identifiers in <code>X</code>.
</p>
<p><span id="rsh_from"></span></p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> {flipCoin, rollDice </span><span style="color: #CF222E">as</span><span style="color: #24292F"> d6} </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'games-of-chance.rsh'</span><span style="color: #24292F">;</span></li></ol></pre>
<p>Import statements may limit or rename the imported identifiers.</p>
<pre class="snippet unnumbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> gamesOfChance </span><span style="color: #CF222E">from</span><span style="color: #24292F"> </span><span style="color: #0A3069">'games-of-chance.rsh'</span><span style="color: #24292F">;</span></li></ol></pre>
<p>
  Imports may instead bind the entire module to a single identifier,
  which is an object with fields corresponding to that module's exports.
</p>
<p>Import cycles are invalid.</p>
<p>The path given to an import may <strong>not</strong> include <code>..</code> to specify files outside the current directory <strong>nor</strong> may it be an absolute path.</p>
<p>It <strong>must</strong> be a relative path, which is resolved relative to the parent directory of the source file in which they appear.</p>
<h4 id="ref-programs-import-package">Package imports<a aria-hidden="true" tabindex="-1" href="#ref-programs-import-package"><span class="icon icon-link"></span></a></h4>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> func </span><span style="color: #CF222E">from</span></li><li value="2"><span style="color: #24292F">  </span><span style="color: #0A3069">'@reach-sh/reach-example-package'</span><span style="color: #24292F">;</span></li><li value="3"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> func </span><span style="color: #CF222E">from</span></li><li value="4"><span style="color: #24292F">  </span><span style="color: #0A3069">'@reach-sh/reach-example-package:src/func.rsh'</span><span style="color: #24292F">;</span></li><li value="5"><span style="color: #CF222E">import</span><span style="color: #24292F"> </span><span style="color: #0550AE">*</span><span style="color: #24292F"> </span><span style="color: #CF222E">as</span><span style="color: #24292F"> func </span><span style="color: #CF222E">from</span></li><li value="6"><span style="color: #24292F">  </span><span style="color: #0A3069">'@github.com:reach-sh/reach-example-package#main:src/func.rsh'</span><span style="color: #24292F">;</span></li></ol></pre>
<p>
  <span id="term_Package%20imports">Package imports</span> obey the same rules as local imports but
  support an extended path syntax which allows Reach programmers to seamlessly
  plug into third-party libraries hosted on the internet.
</p>
<p>All package imports begin with the <code>@</code> character.</p>
<p>Package import paths are comprised of the following components:</p>
<ul>
  <li><strong>(Optional): The <code>git</code> server where the package is hosted.</strong></li>
</ul>
<p>This component must be followed by a <code>:</code> character.</p>
<p>This component defaults to <a href="https://github.com">GitHub</a> (i.e. <code>github.com</code>) if no site is specified.</p>
<p>Examples: <code>github.com:</code>, <code>bitbucket.org:</code>.</p>
<ul>
  <li><strong>The account registered with the host site.</strong></li>
</ul>
<p>This component must be followed by a <code>/</code> character.</p>
<p>Examples: <code>reach-sh/</code>, <code>jeapostrophe/</code>.</p>
<ul>
  <li><strong>A repository associated with the account.</strong></li>
</ul>
<p>Examples: <code>reach-example-package</code>, <code>nfts</code>.</p>
<ul>
  <li><strong>(Optional): A <code>git ref</code> or <code>git commit</code> used to represent the
package version.</strong></li>
</ul>
<p>
  If no <code>ref</code> is specified, Reach first tries to find the requested module
  on the repository's <code>master</code> branch, and if that fails then on the <code>main</code>
  branch once more.
</p>
<div class="note">
  <p>
    <code>git refs</code> are discussed in further detail
    <a href="https://git-scm.com/docs/gitglossary#Documentation/gitglossary.txt-aiddefrefaref">here</a>.
  </p>
</div>
<p><strong>It is highly advisable that package authors use <code>git tags</code> to denote
version "releases", e.g. <code>v0.2.1</code>, and that consuming code target the
desired <code>git tag</code> rather than a branch name.</strong></p>
<div class="note">
  <p>
    Read
    <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging">this guide</a>
    to learn more about how <code>git tags</code> work.
  </p>
</div>
<p>This component must be preceded by a <code>#</code> character.</p>
<p>Example: <code>#v3.0.6</code>.</p>
<ul>
  <li><strong>(Optional): The directory in which the module may be found.</strong></li>
</ul>
<p>
  This component must be preceded by a <code>:</code> character and must end with
  a <code>/</code>.
</p>
<p>Example: <code>:src/lib/</code>.</p>
<ul>
  <li><strong>(Optional): The filename of the requested module.</strong></li>
</ul>
<p>Defaults to <code>index.rsh</code>.</p>
<p>
  If the module exists within a subdirectory it must be preceded by a <code>/</code>
  character.
</p>
<p>Example: <code>@reach-sh/example#v1.01:parent/child/pkg.rsh</code>.</p>
<p>
  However, if the module is stored in the root of the repository, it must instead
  be preceded by a <code>:</code> character.
</p>
<p>Example: <code>@reach-sh/example#v1.02:pkg.rsh</code>.</p>
<p>
  The following forms are all syntactically valid package import
  expressions:
</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"></li><li value="2">@account/repo</li><li value="3">@account/repo:</li><li value="4">@account/repo:a/b/file.rsh</li><li value="5">@account/repo:a/b/</li><li value="6">@account/repo:file.rsh</li><li value="7">@account/repo#</li><li value="8">@account/repo#:</li><li value="9">@account/repo#:a/b/file.rsh</li><li value="10">@account/repo#:a/b/</li><li value="11">@account/repo#:file.rsh</li><li value="12">@account/repo#ref</li><li value="13">@account/repo#ref:</li><li value="14">@account/repo#ref:a/b/file.rsh</li><li value="15">@account/repo#ref:a/b/</li><li value="16">@account/repo#ref:file.rsh</li><li value="17">@server:account/repo</li><li value="18">@server:account/repo:</li><li value="19">@server:account/repo:a/b/file.rsh</li><li value="20">@server:account/repo:a/b/</li><li value="21">@server:account/repo:file.rsh</li><li value="22">@server:account/repo#</li><li value="23">@server:account/repo#:</li><li value="24">@server:account/repo#:a/b/file.rsh</li><li value="25">@server:account/repo#:a/b/</li><li value="26">@server:account/repo#:file.rsh</li><li value="27">@server:account/repo#ref</li><li value="28">@server:account/repo#ref:</li><li value="29">@server:account/repo#ref:a/b/file.rsh</li><li value="30">@server:account/repo#ref:a/b/</li><li value="31">@server:account/repo#ref:file.rsh</li></ol></pre>
<hr>
<p>
  Since <code>git</code> repositories evolve and change over time, Reach takes extra
  steps in order to pin a given module import's version to the specific <code>SHA</code> hash of the specified revision at the time the package is first installed.
  These pins are stored in a lockfile, which should be included in your source control system.
</p>
<h2 id="ref-programs-module-exprs">Expressions<a aria-hidden="true" tabindex="-1" href="#ref-programs-module-exprs"><span class="icon icon-link"></span></a></h2>
<p>
  Any expressions valid for a <a href="/md/reach/compute/#ref-programs-compute-exprs">computation</a> are valid for a module.
  However, some additional expressions are allowed.
</p>
<h3 id="ref-programs-reachapp"><code>Reach.App</code><a aria-hidden="true" tabindex="-1" href="#ref-programs-reachapp"><span class="icon icon-link"></span></a></h3>
<p><span id="rsh_Reach"></span><span id="rsh_App"></span></p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">A</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">"A"</span><span style="color: #24292F">, {</span></li><li value="3"><span style="color: #24292F">  displayResult: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">(Int, Null),</span></li><li value="4"><span style="color: #24292F"> });</span></li><li value="5"><span style="color: #24292F"> </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="6"></li><li value="7"><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">result</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">;</span></li><li value="8"><span style="color: #24292F"> </span><span style="color: #0550AE">A</span><span style="color: #24292F">.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> { interact.</span><span style="color: #8250DF">displayResult</span><span style="color: #24292F">(result); });</span></li><li value="9"></li><li value="10"><span style="color: #24292F"> </span><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></li><li value="11"><span style="color: #24292F">});</span></li></ol></pre>
<p>
  <span id="term_Reach.App">Reach.App</span> accepts a no-argument function that specifies a DApp.
  This function is applied during compilation as an application initialization.
  It specifies the entire DApp in its body.
</p>
<p>If the result of <code>Reach.App</code> is eventually bound to an identifier that is exported, then that identifier may be a target given to the compiler, as discussed in <a href="/md/ref/usage/#ref-usage-compile">the section on usage</a>.</p>
<h4 id="deprecated-long-form">Deprecated long-form<a aria-hidden="true" tabindex="-1" href="#deprecated-long-form"><span class="icon icon-link"></span></a></h4>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #CF222E">export</span><span style="color: #24292F"> </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">main</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span></li><li value="2"><span style="color: #24292F">  Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">({}, [</span><span style="color: #8250DF">Participant</span><span style="color: #24292F">(</span><span style="color: #0A3069">"A"</span><span style="color: #24292F">, {displayResult: </span><span style="color: #8250DF">Fun</span><span style="color: #24292F">(Int, Null)})], (</span><span style="color: #953800">A</span><span style="color: #24292F">) </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="3"><span style="color: #24292F">    </span><span style="color: #CF222E">const</span><span style="color: #24292F"> </span><span style="color: #0550AE">result</span><span style="color: #24292F"> </span><span style="color: #CF222E">=</span><span style="color: #24292F"> </span><span style="color: #0550AE">0</span><span style="color: #24292F">;</span></li><li value="4"><span style="color: #24292F">    </span><span style="color: #0550AE">A</span><span style="color: #24292F">.</span><span style="color: #8250DF">only</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> { interact.</span><span style="color: #8250DF">displayResult</span><span style="color: #24292F">(result); })</span></li><li value="5"><span style="color: #24292F">    </span><span style="color: #8250DF">exit</span><span style="color: #24292F">();</span></li><li value="6"><span style="color: #24292F">  });</span></li></ol></pre>
<p>
  Previous versions of Reach only allowed a form of Reach.App which accepted three arguments:
  an <code>options</code> object,
  an <code>applicationArgs</code> tuple,
  and a <code>program</code> arrow of the form <code>(applicationIds) =&gt; body</code>.
</p>
<p>This form was equivalent to</p>
<pre class="snippet numbered"><ol class="snippet"><li value="1"><span style="color: #24292F">Reach.</span><span style="color: #8250DF">App</span><span style="color: #24292F">(() </span><span style="color: #CF222E">=&gt;</span><span style="color: #24292F"> {</span></li><li value="2"><span style="color: #24292F"> </span><span style="color: #8250DF">setOptions</span><span style="color: #24292F">(options);</span></li><li value="3"><span style="color: #24292F"> [ applicationIds ] </span><span style="color: #CF222E">=</span><span style="color: #24292F"> applicationArgs;</span></li><li value="4"><span style="color: #24292F"> </span><span style="color: #8250DF">deploy</span><span style="color: #24292F">();</span></li><li value="5"><span style="color: #24292F"> body</span></li><li value="6"><span style="color: #24292F">});</span></li></ol></pre>
<p>The current version of Reach will automatically transform these "ternary" <code>Reach.App</code> instances into the above form.</p>
<p>Future versions of Reach will deprecate this transform and such programs will be invalid.</p>