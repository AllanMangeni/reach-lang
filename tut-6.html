<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.6&nbsp;Timeouts and Participation</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-2.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="tut-3.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="tut-4.html" class="tocviewlink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="tut-7.html" class="tocviewlink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-9.html" class="tocviewlink" data-pltdoc="x">Web Interaction</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="tut-10.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr><tr><td align="right">2.11&nbsp;</td><td><a href="tut-7-rpc.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, Scissors in Python</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="tut-5.html" title="backward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-7.html" title="forward to &quot;2.7 Play and Play Again&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.6<tt>&nbsp;</tt><a name="(part._tut-6)"></a>Timeouts and Participation</h4><p>In the last section, we removed a security vulnerability from <span class="emph">Rock, Paper, Scissors!</span> that was a clear attack on the viability of the application.
In this section, we&rsquo;ll focus on a more subtle issue that is important and unique to decentralized applications: <a href="guide-timeout.html" data-pltdoc="x">non-participation</a>.</p><p>Non-participation refers to the act of one party ceasing to continue playing their role in an application.</p><p>In traditional client-server programs, like a Web server, this would be the case of a client not sending any more requests to the server, or the server stopping sending responses to the client.
In these sorts of traditional programs, non-participation is an exceptional circumstance that normally leads to an error message for clients and, at most, a log entry for servers.
Sometimes traditional programs will need to recycle resources, like network ports, on non-participation, but they would have also needed to do that if the transaction ended by normal means.
In other words, for traditional client-server programs, it is not necessary for designers to meticulously consider the consequences of non-participation.</p><p>In contrast, decentralized applications must be carefully designed with an eye towards their behavior in the face of non-participation.
For example, consider what happens in our <span class="emph">Rock, Paper, Scissors!</span> game if after Alice has paid her wager, Bob never accepts and the application doesn&rsquo;t continue.
In this case, Alice&rsquo;s <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network tokens</span></a> would be locked inside of the <a href="ref-model.html#%28tech._contract%29" class="techoutside" data-pltdoc="x"><span class="techinside">contract</span></a> and lost to her.
Similarly, if after Bob accepted and paid his wager, Alice stopped participating and never submitted her hand, then both their funds would be locked away forever.
In each of these cases, both parties would be greatly hurt and their fear of that outcome would introduce an additional cost to transacting, which would lower the value they got from participating in the application.
Of course, in a situation like <span class="emph">Rock, Paper, Scissors!</span> this is unlikely to be an important matter, but recall that <span class="emph">Rock, Paper, Scissors!</span> is a microcosm of decentralized application design.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Technically, in the first case, when Bob fails to start the application, Alice is not locked away from her funds: since Bob&rsquo;s identity is not fixed until after his first message, she could start another instance of the game as the Bob role and then she&rsquo;d win all of the funds, less any transaction costs of the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a>.
In the second case, however, there would be no recourse for either party.</p></blockquote></blockquote></blockquote><p>In the rest of this section, we&rsquo;ll discuss how Reach helps address non-participation.
For a longer discussion, refer to <a href="guide-timeout.html" data-pltdoc="x">the guide chapter on non-participation</a>.</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>In Reach, non-participation is handled through a "timeout" mechanism whereby each <a href="ref-model.html#%28tech._consensus._transfer%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus transfer</span></a> can be paired with a <a href="ref-model.html#%28tech._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">step</span></a> that occurs for all <a href="ref-model.html#%28tech._participant%29" class="techoutside" data-pltdoc="x"><span class="techinside">participants</span></a> if the <a href="ref-model.html#%28tech._originator%29" class="techoutside" data-pltdoc="x"><span class="techinside">originator</span></a> of the <a href="ref-model.html#%28tech._consensus._transfer%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus transfer</span></a> fails to make the required <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a> before a particular <a href="ref-model.html#%28tech._network._time%29" class="techoutside" data-pltdoc="x"><span class="techinside">network time</span></a>.
We&rsquo;ll integrate this mechanism into our version of <span class="emph">Rock, Paper, Scissors!</span> and deliberately insert non-participation into our JavaScript testing program to watch the consequences play out.</p><p>First, we&rsquo;ll modify the <a href="ref-programs-appinit.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a> to allow the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> to be informed that a timeout occurred.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L20-L25"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="const Player = {
  ...hasRandom,
  getHand: Fun([], UInt),
  seeOutcome: Fun([UInt], Null),
  informTimeout: Fun([], Null),
};"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">20</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span>
<span class="mi">21</span>      <span class="p">...</span><a href="ref-programs-compute.html#%28reach._%28%28has.Random%29%29%29" class="nb" data-pltdoc="x">hasRandom</a><span class="p">,</span>
<span class="mi">22</span>      <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">),</span>
<span class="mi">23</span>      <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
<span class="mi">24</span>      <font class="badlink"><span class="nx">informTimeout</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
<span class="mi">25</span>    <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 24 introduces a new method, <code class="highlight"><font class="badlink"><span class="nx">informTimeout</span></font></code>, that receives no arguments and returns no information.
We&rsquo;ll call this function when a timeout occurs.</p></li></ul><p>We&rsquo;ll make a slight tweak to our JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> to be able to receive this message and display it on the console.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.mjs#L20-L33"><span class="stt">rps-6-timeouts/index.mjs</span></a><button class="btn" data-clipboard-text="  const Player = (Who) =&gt; ({
    ...stdlib.hasRandom,
    getHand: () =&gt; {
      const hand = Math.floor(Math.random() * 3);
      console.log(`${Who} played ${HAND[hand]}`);
      return hand;
    },
    seeOutcome: (outcome) =&gt; {
      console.log(`${Who} saw outcome ${OUTCOME[outcome]}`);
    },
    informTimeout: () =&gt; {
      console.log(`${Who} observed a timeout`);
    },
  });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">20</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">Who</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">({</span>
<span class="mf">21</span>      <span class="p">...</span><a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><font class="badlink"><span class="nx">hasRandom</span></font><span class="p">,</span>
<span class="mf">22</span>      <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">23</span>        <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">hand</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">floor</span></font><span class="p">(</span><font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">*</span></font> <span class="mf">3</span><span class="p">);</span>
<span class="mf">24</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> played </span><span class="si">${</span><font class="badlink"><span class="nx">HAND</span></font><span class="p">[</span><font class="badlink"><span class="nx">hand</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">25</span>        <font class="badlink"><span class="k">return</span></font> <font class="badlink"><span class="nx">hand</span></font><span class="p">;</span>
<span class="mf">26</span>      <span class="p">},</span>
<span class="mf">27</span>      <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">28</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> saw outcome </span><span class="si">${</span><font class="badlink"><span class="nx">OUTCOME</span></font><span class="p">[</span><font class="badlink"><span class="nx">outcome</span></font><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="mf">29</span>      <span class="p">},</span>
<span class="mf">30</span>      <font class="badlink"><span class="nx">informTimeout</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">31</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`</span><span class="si">${</span><font class="badlink"><span class="nx">Who</span></font><span class="si">}</span><span class="sb"> observed a timeout`</span><span class="p">);</span>
<span class="mf">32</span>      <span class="p">},</span>
<span class="mf">33</span>    <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>Back in the Reach program, we&rsquo;ll declare a value to use as a standard deadline throughout the program.
Similar to how she provides the wager, we will have Alice also provide the deadline.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L28-L32"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="  const Alice = Participant('Alice', {
    ...Player,
    wager: UInt, // atomic units of currency
    deadline: UInt, // time delta (blocks/rounds)
  });"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">28</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Alice</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-appinit.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="mi">29</span>      <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">,</span>
<span class="mi">30</span>      <font class="badlink"><span class="nx">wager</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span> <span class="c1">// atomic units of currency</span>
<span class="mi">31</span>      <font class="badlink"><span class="nx">deadline</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span> <span class="c1">// time delta (blocks/rounds)</span>
<span class="mi">32</span>    <span class="p">});</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 31 adds the <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code> field to Alice&rsquo;s <a href="ref-programs-appinit.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.
It is defined as some number of <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a> units,
which are an abstraction of the underlying notion of <a href="ref-model.html#%28tech._network._time%29" class="techoutside" data-pltdoc="x"><span class="techinside">network time</span></a> in the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a>.
In many networks, like Ethereum, this number is a number of blocks.</p></li></ul><p>Next, at the start of the Reach application, we&rsquo;ll define a helper function to inform each of the participants of the timeout by calling this new method.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L39-L43"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="  const informTimeout = () =&gt; {
    each([Alice, Bob], () =&gt; {
      interact.informTimeout();
    });
  };"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">39</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">informTimeout</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">40</span>      <a href="ref-programs-step.html#%28reach._%28%28each%29%29%29" class="k" data-pltdoc="x">each</a><span class="p">([</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">Bob</span></font><span class="p">],</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">41</span>        <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">informTimeout</span></font><span class="p">();</span>
<span class="mi">42</span>      <span class="p">});</span>
<span class="mi">43</span>    <span class="p">};</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 39 defines the function as an <a href="ref-programs-compute.html#%28tech._arrow._expression%29" class="techoutside" data-pltdoc="x"><span class="techinside">arrow expression</span></a>.</p></li><li><p>Line 40 has each of the participants perform a <a href="ref-model.html#%28tech._local._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">local step</span></a>.</p></li><li><p>Line 41 has them call the new <code class="highlight"><font class="badlink"><span class="nx">informTimeout</span></font></code> method.</p></li></ul><p>We will have Alice declassify and publish the <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code> for later <a href="ref-model.html#%28tech._timeout%29" class="techoutside" data-pltdoc="x"><span class="techinside">timeout</span></a> clauses.</p><p>We won&rsquo;t add a <a href="ref-model.html#%28tech._timeout%29" class="techoutside" data-pltdoc="x"><span class="techinside">timeout</span></a> clause to Alice&rsquo;s first message, because there is no consequence to her non-participation:
if she doesn&rsquo;t start the game, then no one is any worse off.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L45-L54"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="  Alice.only(() =&gt; {
    const wager = declassify(interact.wager);
    const _handAlice = interact.getHand();
    const [_commitAlice, _saltAlice] = makeCommitment(interact, _handAlice);
    const commitAlice = declassify(_commitAlice);
    const deadline = declassify(interact.deadline);
  });
  Alice.publish(wager, commitAlice, deadline)
    .pay(wager);
  commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">45</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">46</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">wager</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">47</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">_handAlice</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">();</span>
<span class="mi">48</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <span class="p">[</span><font class="badlink"><span class="nx">_commitAlice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">_saltAlice</span></font><span class="p">]</span> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28make.Commitment%29%29%29" class="nb" data-pltdoc="x">makeCommitment</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">,</span> <font class="badlink"><span class="nx">_handAlice</span></font><span class="p">);</span>
<span class="mi">49</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">commitAlice</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><font class="badlink"><span class="nx">_commitAlice</span></font><span class="p">);</span>
<span class="mi">50</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">deadline</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">deadline</span></font><span class="p">);</span>
<span class="mi">51</span>    <span class="p">});</span>
<span class="mi">52</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">,</span> <font class="badlink"><span class="nx">commitAlice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">deadline</span></font><span class="p">)</span>
<span class="mi">53</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">54</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 50 has Alice declassify the <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code> <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a>.</p></li><li><p>Line 52 now has Alice publish the <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code>.</p></li></ul><p>However, we will adjust Bob&rsquo;s first message, because if he fails to participate, then Alice&rsquo;s initial wager will be lost to her.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L61-L64"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="  Bob.publish(handBob)
    .pay(wager)
    .timeout(relativeTime(deadline), () =&gt; closeTo(Alice, informTimeout));
  commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">61</span>    <font class="badlink"><span class="nx">Bob</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">handBob</span></font><span class="p">)</span>
<span class="mi">62</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">)</span>
<span class="mi">63</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28relative.Time%29%29%29" class="nx" data-pltdoc="x">relativeTime</a><span class="p">(</span><font class="badlink"><span class="nx">deadline</span></font><span class="p">),</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="mi">64</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 63 adds a timeout handler to Bob&rsquo;s <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a>.</p></li></ul><p>The timeout handler specifies that if Bob does not complete this action within a <a href="ref-model.html#%28tech._time._delta%29" class="techoutside" data-pltdoc="x"><span class="techinside">time delta</span></a> of <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code>, then the application transitions to the <a href="ref-model.html#%28tech._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">step</span></a> given by the arrow expression.
In this case, the timeout code is a call to <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a></code>, which is a Reach standard library function that has Alice send a message and transfer all of the funds in the <a href="ref-model.html#%28tech._contract%29" class="techoutside" data-pltdoc="x"><span class="techinside">contract</span></a> to herself, then call the given function afterwards.
This means that if Bob fails to publish his hand, then Alice will take her <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network tokens</span></a> back.</p><p>We will add a similar timeout handler to Alice&rsquo;s second message.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh#L70-L71"><span class="stt">rps-6-timeouts/index.rsh</span></a><button class="btn" data-clipboard-text="  Alice.publish(saltAlice, handAlice)
    .timeout(relativeTime(deadline), () =&gt; closeTo(Bob, informTimeout));"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">70</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">saltAlice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handAlice</span></font><span class="p">)</span>
<span class="mi">71</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a><span class="p">(</span><a href="ref-programs-compute.html#%28reach._%28%28relative.Time%29%29%29" class="nx" data-pltdoc="x">relativeTime</a><span class="p">(</span><font class="badlink"><span class="nx">deadline</span></font><span class="p">),</span> <span class="p">()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <a href="ref-programs-step.html#%28reach._%28%28close.To%29%29%29" class="nb" data-pltdoc="x">closeTo</a><span class="p">(</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">,</span> <font class="badlink"><span class="nx">informTimeout</span></font><span class="p">));</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><p>But in this case, Bob will be able to claim all of the funds if Alice doesn&rsquo;t participate.
You might think that it would be "fair" for Alice&rsquo;s funds to be returned to Alice and Bob&rsquo;s to Bob.
However, if we implemented it that way,
then Alice would be wise to always timeout if she were going to lose,
which she knows will happen, because she knows her hand and Bob&rsquo;s hand.</p><p>These are the only changes we need to make to the Reach program to make it robust against non-participation: eleven lines!</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Let&rsquo;s modify the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> to deliberately cause a timeout sometimes when Bob is supposed to accept the wager.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.mjs#L35-L54"><span class="stt">rps-6-timeouts/index.mjs</span></a><button class="btn" data-clipboard-text="  await Promise.all([
    ctcAlice.p.Alice({
      ...Player('Alice'),
      wager: stdlib.parseCurrency(5),
      deadline: 10,
    }),
    ctcBob.p.Bob({
      ...Player('Bob'),
      acceptWager: async (amt) =&gt; { // &lt;-- async now
        if ( Math.random() &lt;= 0.5 ) {
          for ( let i = 0; i &lt; 10; i++ ) {
            console.log(`  Bob takes his sweet time...`);
            await stdlib.wait(1);
          }
        } else {
          console.log(`Bob accepts the wager of ${fmt(amt)}.`);
        }
      },
    }),
  ]);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">35</span>    <font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nb">Promise</span></font><span class="p">.</span><font class="badlink"><span class="nx">all</span></font><span class="p">([</span>
<span class="mf">36</span>      <font class="badlink"><span class="nx">ctcAlice</span></font><span class="p">.</span><font class="badlink"><span class="nx">p</span></font><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">({</span>
<span class="mf">37</span>        <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span>
<span class="mf">38</span>        <font class="badlink"><span class="nx">wager</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-utils.html#%28javascript._%28%28parse.Currency%29%29%29" class="nx" data-pltdoc="x">parseCurrency</a><span class="p">(</span><span class="mf">5</span><span class="p">),</span>
<span class="mf">39</span>        <font class="badlink"><span class="nx">deadline</span></font><font class="badlink"><span class="o">:</span></font> <span class="mf">10</span><span class="p">,</span>
<span class="mf">40</span>      <span class="p">}),</span>
<span class="mf">41</span>      <font class="badlink"><span class="nx">ctcBob</span></font><span class="p">.</span><font class="badlink"><span class="nx">p</span></font><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">({</span>
<span class="mf">42</span>        <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
<span class="mf">43</span>        <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <font class="badlink"><span class="k">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="c1">// &lt;-- async now</span>
<span class="mf">44</span>          <font class="badlink"><span class="k">if</span></font> <span class="p">(</span> <font class="badlink"><span class="nb">Math</span></font><span class="p">.</span><font class="badlink"><span class="nx">random</span></font><span class="p">()</span> <font class="badlink"><span class="o">&lt;=</span></font> <span class="mf">0.5</span> <span class="p">)</span> <span class="p">{</span>
<span class="mf">45</span>            <font class="badlink"><span class="k">for</span></font> <span class="p">(</span> <font class="badlink"><span class="kd">let</span></font> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">=</span></font> <span class="mf">0</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font> <font class="badlink"><span class="o">&lt;</span></font> <span class="mf">10</span><span class="p">;</span> <font class="badlink"><span class="nx">i</span></font><font class="badlink"><span class="o">++</span></font> <span class="p">)</span> <span class="p">{</span>
<span class="mf">46</span>              <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`  Bob takes his sweet time...`</span><span class="p">);</span>
<span class="mf">47</span>              <font class="badlink"><span class="k">await</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-network.html#%28javascript._%28%28wait%29%29%29" class="nx" data-pltdoc="x">wait</a><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="mf">48</span>            <span class="p">}</span>
<span class="mf">49</span>          <span class="p">}</span> <font class="badlink"><span class="k">else</span></font> <span class="p">{</span>
<span class="mf">50</span>            <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Bob accepts the wager of </span><span class="si">${</span><font class="badlink"><span class="nx">fmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="mf">51</span>          <span class="p">}</span>
<span class="mf">52</span>        <span class="p">},</span>
<span class="mf">53</span>      <span class="p">}),</span>
<span class="mf">54</span>    <span class="p">]);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 39 has Alice specify a <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code> of ten blocks.</p></li><li><p>Lines 43 through 52 redefine Bob&rsquo;s <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> method as an asynchronous function,
where half of the time it will take at least ten blocks on the Ethereum network by waiting for ten units of time to pass.
We know that ten is the value of <code class="highlight"><font class="badlink"><span class="nx">deadline</span></font></code>, so this will cause a timeout.</p></li></ul><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Let&rsquo;s run the program and see what happens:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.</span></p></td></tr><tr><td><p><span class="stt">Bob played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 94.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 104.9999.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Scissors</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob observed a timeout</span></p></td></tr><tr><td><p><span class="stt">Alice observed a timeout</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10 to 9.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10 to 9.9999.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">Bob takes his sweet time...</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Bob observed a timeout</span></p></td></tr><tr><td><p><span class="stt">Alice observed a timeout</span></p></td></tr><tr><td><p><span class="stt">Alice went from 10 to 9.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 10 to 9.9999.</span></p></td></tr></table></p><p>Of course, when you run, you may not get two of the three times ending in a timeout.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.rsh"><span class="stt">rps-6-timeouts/index.rsh</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-6-timeouts/index.mjs"><span class="stt">rps-6-timeouts/index.mjs</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>Now our implementation of <span class="emph">Rock, Paper, Scissors!</span> is robust against either participant dropping from the game.
In <a href="tut-7.html" data-pltdoc="x">the next step</a>, we&rsquo;ll extend the application to disallow draws and have Alice and Bob play again until there is a winner.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><div class="SIntrapara">Check your understanding: What happens in a decentralized application when one participant refuses to take the next step of the program? For example, if Alice refuses to share her hand with Bob in a game of &#8216;Rock, Paper, Scissors&#8217;. </div><div class="SIntrapara"><ol><li><p>This is not possible, because the blockchain guarantees that each party performs a particular set of actions;</p></li><li><p>The program hangs forever waiting for Alice to provide the value;</p></li><li><p>Alice is punished and the program proceeds as-if Bob were the winner;</p></li><li><p>It depends on how the program was written; if the developer used Reach, the default is (2), but the developer could include a <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28timeout%29%29%29" class="k" data-pltdoc="x">timeout</a></code> block to implement the (3) behavior.</p></li></ol></div><div class="SIntrapara"><blockquote class="check-answer"><p><div class="SIntrapara">Answer: </div><div class="SIntrapara"><p class="check-answer-body">4; Reach empowers programmers to design the application with the business logic they want.</p></div></p></blockquote></div></p></blockquote></blockquote></blockquote><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="tut-5.html" title="backward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-7.html" title="forward to &quot;2.7 Play and Play Again&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>