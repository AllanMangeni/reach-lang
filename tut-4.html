<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149147406-2"></script><script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-149147406-2');</script><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script><script src="tooltips.js"></script><script src="reach-pre.js"></script><link rel="stylesheet" href="tooltips.css"><link rel="stylesheet" href="reach.css"><link rel="stylesheet" href="minted.css"><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>2.4&nbsp;Bets and Wagers</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Reach:<span class="mywbr"> &nbsp;</span> The Safest and Easiest DApp Programming Language</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="overview.html" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="tut.html" class="tocviewselflink" data-pltdoc="x">Tutorial</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="guide.html" class="tocviewlink" data-pltdoc="x">Guide</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="workshop.html" class="tocviewlink" data-pltdoc="x">Workshop</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="ref.html" class="tocviewlink" data-pltdoc="x">Reference</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" data-pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>2&nbsp;</td><td><a href="tut.html" class="tocviewlink" data-pltdoc="x">Tutorial</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">2.1&nbsp;</td><td><a href="tut-1.html" class="tocviewlink" data-pltdoc="x">Install and Initialize</a></td></tr><tr><td align="right">2.2&nbsp;</td><td><a href="tut-2.html" class="tocviewlink" data-pltdoc="x">Scaffolding and Setup</a></td></tr><tr><td align="right">2.3&nbsp;</td><td><a href="tut-3.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, and Scissors</a></td></tr><tr><td align="right">2.4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Bets and Wagers</a></td></tr><tr><td align="right">2.5&nbsp;</td><td><a href="tut-5.html" class="tocviewlink" data-pltdoc="x">Trust and Commitments</a></td></tr><tr><td align="right">2.6&nbsp;</td><td><a href="tut-6.html" class="tocviewlink" data-pltdoc="x">Timeouts and Participation</a></td></tr><tr><td align="right">2.7&nbsp;</td><td><a href="tut-7.html" class="tocviewlink" data-pltdoc="x">Play and Play Again</a></td></tr><tr><td align="right">2.8&nbsp;</td><td><a href="tut-8.html" class="tocviewlink" data-pltdoc="x">Interaction and Independence</a></td></tr><tr><td align="right">2.9&nbsp;</td><td><a href="tut-9.html" class="tocviewlink" data-pltdoc="x">Web Interaction</a></td></tr><tr><td align="right">2.10&nbsp;</td><td><a href="tut-10.html" class="tocviewlink" data-pltdoc="x">Onward and Further</a></td></tr><tr><td align="right">2.11&nbsp;</td><td><a href="tut-7-rpc.html" class="tocviewlink" data-pltdoc="x">Rock, Paper, Scissors in Python</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="tut-3.html" title="backward to &quot;2.3 Rock, Paper, and Scissors&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-5.html" title="forward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>2.4<tt>&nbsp;</tt><a name="(part._tut-4)"></a>Bets and Wagers</h4><p>Although it&rsquo;s fun to play <span class="emph">Rock, Paper, Scissors!</span> with friends for a laugh, it&rsquo;s even better to play it with enemies and your entire life-savings on the line!
Let&rsquo;s change our program so that Alice can offer a wager to Bob and whoever wins will take the pot.</p><p>This time, let&rsquo;s start with changes to the JavaScript <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> and then we&rsquo;ll go back into the Reach code and connect the new methods up.</p><p>Since we&rsquo;re going to be having funds get transferred, we&rsquo;ll record the balances of each participant before the game starts, so we can more clearly show what they won at the end.
We&rsquo;ll add this code in between account creation and contract deployment.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs#L6-L13"><span class="stt">rps-3-bets/index.mjs</span></a><button class="btn" data-clipboard-text="  const startingBalance = stdlib.parseCurrency(100);
  const accAlice = await stdlib.newTestAccount(startingBalance);
  const accBob = await stdlib.newTestAccount(startingBalance);

  const fmt = (x) =&gt; stdlib.formatCurrency(x, 4);
  const getBalance = async (who) =&gt; fmt(await stdlib.balanceOf(who));
  const beforeAlice = await getBalance(accAlice);
  const beforeBob = await getBalance(accBob);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
 <span class="mf">6</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">startingBalance</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-utils.html#%28javascript._%28%28parse.Currency%29%29%29" class="nx" data-pltdoc="x">parseCurrency</a><span class="p">(</span><span class="mf">100</span><span class="p">);</span>
 <span class="mf">7</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">accAlice</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-acc.html#%28javascript._%28%28new.Test.Account%29%29%29" class="nx" data-pltdoc="x">newTestAccount</a><span class="p">(</span><font class="badlink"><span class="nx">startingBalance</span></font><span class="p">);</span>
 <span class="mf">8</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">accBob</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-acc.html#%28javascript._%28%28new.Test.Account%29%29%29" class="nx" data-pltdoc="x">newTestAccount</a><span class="p">(</span><font class="badlink"><span class="nx">startingBalance</span></font><span class="p">);</span>
 <span class="mf">9</span>    
<span class="mf">10</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">fmt</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">)</span> <span class="p">=&gt;</span> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-utils.html#%28javascript._%28%28format.Currency%29%29%29" class="nx" data-pltdoc="x">formatCurrency</a><span class="p">(</span><font class="badlink"><span class="nx">x</span></font><span class="p">,</span> <span class="mf">4</span><span class="p">);</span>
<span class="mf">11</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">getBalance</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">async</span></font> <span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">)</span> <span class="p">=&gt;</span> <font class="badlink"><span class="nx">fmt</span></font><span class="p">(</span><font class="badlink"><span class="k">await</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-acc.html#%28javascript._%28%28balance.Of%29%29%29" class="nx" data-pltdoc="x">balanceOf</a><span class="p">(</span><font class="badlink"><span class="nx">who</span></font><span class="p">));</span>
<span class="mf">12</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">beforeAlice</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accAlice</span></font><span class="p">);</span>
<span class="mf">13</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">beforeBob</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accBob</span></font><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 10 shows a helpful function for displaying currency amounts with up to 4 decimal places.</p></li><li><p>Line 11 shows a helpful function for getting the balance of a participant and displaying it with up to 4 decimal places.</p></li><li><p>Lines 12 and 13 get the balance before the game starts for both Alice and Bob.</p></li></ul><p>Next, we&rsquo;ll update Alice&rsquo;s interface object to include her wager.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs#L32-L35"><span class="stt">rps-3-bets/index.mjs</span></a><button class="btn" data-clipboard-text="    backend.Alice(ctcAlice, {
      ...Player('Alice'),
      wager: stdlib.parseCurrency(5),
    }),"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">32</span>    <a href="ref-backends-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcAlice</span></font><span class="p">,</span> <span class="p">{</span>
<span class="mf">33</span>      <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span>
<span class="mf">34</span>      <font class="badlink"><span class="nx">wager</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-frontends-js.html#%28javascript._%28%28stdlib%29%29%29" class="nx" data-pltdoc="x">stdlib</a><span class="p">.</span><a href="ref-frontends-js-utils.html#%28javascript._%28%28parse.Currency%29%29%29" class="nx" data-pltdoc="x">parseCurrency</a><span class="p">(</span><span class="mf">5</span><span class="p">),</span>
<span class="mf">35</span>    <span class="p">}),</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 33 splices the common <code class="highlight"><font class="badlink"><span class="nx">Player</span></font></code> interface into Alice&rsquo;s interface.</p></li><li><p>Line 34 defines her wager as <span class="RktInBG"><span class="hspace"></span><span class="RktIn">5</span><span class="hspace"></span></span> units of the <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network token</span></a>.
This is an example of using a concrete value, rather than a function, in a <a href="ref-programs-appinit.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.</p></li></ul><p>For Bob, we&rsquo;ll modify his interface to show the wager and immediately accept it by returning.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs#L36-L41"><span class="stt">rps-3-bets/index.mjs</span></a><button class="btn" data-clipboard-text="    backend.Bob(ctcBob, {
      ...Player('Bob'),
      acceptWager: (amt) =&gt; {
        console.log(`Bob accepts the wager of ${fmt(amt)}.`);
      },
    }),"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">36</span>    <a href="ref-backends-js.html#%28javascript._%28%28backend%29%29%29" class="nx" data-pltdoc="x">backend</a><span class="p">.</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">(</span><font class="badlink"><span class="nx">ctcBob</span></font><span class="p">,</span> <span class="p">{</span>
<span class="mf">37</span>      <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span>
<span class="mf">38</span>      <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
<span class="mf">39</span>        <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Bob accepts the wager of </span><span class="si">${</span><font class="badlink"><span class="nx">fmt</span></font><span class="p">(</span><font class="badlink"><span class="nx">amt</span></font><span class="p">)</span><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="mf">40</span>      <span class="p">},</span>
<span class="mf">41</span>    <span class="p">}),</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 38 through 40 define the <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> function.</p></li></ul><p>Finally, after the computation is over, we&rsquo;ll get the balance again and show a message summarizing the effect.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs#L44-L48"><span class="stt">rps-3-bets/index.mjs</span></a><button class="btn" data-clipboard-text="  const afterAlice = await getBalance(accAlice);
  const afterBob = await getBalance(accBob);

  console.log(`Alice went from ${beforeAlice} to ${afterAlice}.`);
  console.log(`Bob went from ${beforeBob} to ${afterBob}.`);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mf">44</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">afterAlice</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accAlice</span></font><span class="p">);</span>
<span class="mf">45</span>    <font class="badlink"><span class="kd">const</span></font> <font class="badlink"><span class="nx">afterBob</span></font> <font class="badlink"><span class="o">=</span></font> <font class="badlink"><span class="k">await</span></font> <font class="badlink"><span class="nx">getBalance</span></font><span class="p">(</span><font class="badlink"><span class="nx">accBob</span></font><span class="p">);</span>
<span class="mf">46</span>    
<span class="mf">47</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Alice went from </span><span class="si">${</span><font class="badlink"><span class="nx">beforeAlice</span></font><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><font class="badlink"><span class="nx">afterAlice</span></font><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="mf">48</span>    <font class="badlink"><span class="nx">console</span></font><span class="p">.</span><font class="badlink"><span class="nx">log</span></font><span class="p">(</span><span class="sb">`Bob went from </span><span class="si">${</span><font class="badlink"><span class="nx">beforeBob</span></font><span class="si">}</span><span class="sb"> to </span><span class="si">${</span><font class="badlink"><span class="nx">afterBob</span></font><span class="si">}</span><span class="sb">.`</span><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 44 and 45 get the balances afterwards.</p></li><li><p>Lines 47 and 48 print out the effect.</p></li></ul><p>These changes to the <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> only deal with issues of presentation and interfacing.
The actual business logic of making the wager and transferring the funds will happen in the Reach code.</p><p>Let&rsquo;s look at that now.</p><p>First, we need to update the <a href="ref-programs-appinit.html#%28tech._participant._interact._interface%29" class="techoutside" data-pltdoc="x"><span class="techinside">participant interact interface</span></a>.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh#L1-L19"><span class="stt">rps-3-bets/index.rsh</span></a><button class="btn" data-clipboard-text="'reach 0.1';

const Player = {
  getHand: Fun([], UInt),
  seeOutcome: Fun([UInt], Null),
};

export const main = Reach.App(() =&gt; {
  const Alice = Participant('Alice', {
    ...Player,
    wager: UInt,
  });
  const Bob   = Participant('Bob', {
    ...Player,
    acceptWager: Fun([UInt], Null),
  });
  deploy();

  Alice.only(() =&gt; {"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span> <span class="mi">1</span>    <span class="s1">&#39;reach 0.1&#39;</span><span class="p">;</span>
 <span class="mi">2</span>    
 <span class="mi">3</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Player</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">{</span>
 <span class="mi">4</span>    <font class="badlink"><span class="nx">getHand</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([],</span> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">),</span>
 <span class="mi">5</span>    <font class="badlink"><span class="nx">seeOutcome</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
 <span class="mi">6</span>    <span class="p">};</span>
 <span class="mi">7</span>    
 <span class="mi">8</span>    <a href="ref-programs-module.html#%28reach._%28%28export%29%29%29" class="kd" data-pltdoc="x">export</a> <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">main</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-module.html#%28reach._%28%28.Reach%29%29%29" class="nb" data-pltdoc="x">Reach</a><span class="p">.</span><a href="ref-programs-module.html#%28reach._%28%28.App%29%29%29" class="nb" data-pltdoc="x">App</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
 <span class="mi">9</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Alice</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-appinit.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="mi">10</span>      <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">,</span>
<span class="mi">11</span>      <font class="badlink"><span class="nx">wager</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">,</span>
<span class="mi">12</span>    <span class="p">});</span>
<span class="mi">13</span>    <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">Bob</span></font>   <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-appinit.html#%28reach._%28%28.Participant%29%29%29" class="nb" data-pltdoc="x">Participant</a><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="mi">14</span>      <span class="p">...</span><font class="badlink"><span class="nx">Player</span></font><span class="p">,</span>
<span class="mi">15</span>      <font class="badlink"><span class="nx">acceptWager</span></font><font class="badlink"><span class="o">:</span></font> <a href="ref-programs-compute.html#%28reach._%28%28.Fun%29%29%29" class="nb" data-pltdoc="x">Fun</a><span class="p">([</span><a href="ref-programs-compute.html#%28reach._%28%28.U.Int%29%29%29" class="nb" data-pltdoc="x">UInt</a><span class="p">],</span> <a href="ref-programs-compute.html#%28reach._%28%28.Null%29%29%29" class="nb" data-pltdoc="x">Null</a><span class="p">),</span>
<span class="mi">16</span>    <span class="p">});</span>
<span class="mi">17</span>    <a href="ref-programs-appinit.html#%28reach._%28%28deploy%29%29%29" class="nb" data-pltdoc="x">deploy</a><span class="p">();</span>
<span class="mi">18</span>    
<span class="mi">19</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 9 through 12 define Alice&rsquo;s interface as the <code class="highlight"><font class="badlink"><span class="nx">Player</span></font></code> interface, plus an integer value called <code class="highlight"><font class="badlink"><span class="nx">wager</span></font></code>.</p></li><li><p>Lines 13 through 16 do the same for Bob, where he has a method called <code class="highlight"><font class="badlink"><span class="nx">acceptWager</span></font></code> that can look at the wager value.</p></li></ul><p>Each of the three parts of the application have to be updated to deal with the wager.
Let&rsquo;s look at Alice&rsquo;s first step first.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh#L19-L25"><span class="stt">rps-3-bets/index.rsh</span></a><button class="btn" data-clipboard-text="  Alice.only(() =&gt; {
    const wager = declassify(interact.wager);
    const handAlice = declassify(interact.getHand());
  });
  Alice.publish(wager, handAlice)
    .pay(wager);
  commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">19</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">20</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">wager</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">21</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">handAlice</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">());</span>
<span class="mi">22</span>    <span class="p">});</span>
<span class="mi">23</span>    <font class="badlink"><span class="nx">Alice</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">,</span> <font class="badlink"><span class="nx">handAlice</span></font><span class="p">)</span>
<span class="mi">24</span>      <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">25</span>    <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 20 has Alice <a href="ref-programs-local.html#%28tech._declassify%29" class="techoutside" data-pltdoc="x"><span class="techinside">declassify</span></a> the wager for transmission.</p></li><li><p>Line 23 is updated so that Alice shares the wager amount with Bob.</p></li><li><p>Line 24 has her transfer the amount as part of her <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a>.
The Reach compiler would throw an exception if <code class="highlight"><font class="badlink"><span class="nx">wager</span></font></code> did not appear on line 23, but did appear on line 24.
Change the program and try it.
This is because the <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a> needs to be able to verify that the amount of <a href="ref-model.html#%28tech._network._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">network tokens</span></a> included in Alice&rsquo;s <a href="ref-model.html#%28tech._publication%29" class="techoutside" data-pltdoc="x"><span class="techinside">publication</span></a> match some computation available to <a href="ref-model.html#%28tech._consensus._network%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus network</span></a>.</p></li></ul><p>Next, Bob needs to be shown the wager and given the opportunity to accept it and transfer his funds.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh#L27-L32"><span class="stt">rps-3-bets/index.rsh</span></a><button class="btn" data-clipboard-text="  Bob.only(() =&gt; {
    interact.acceptWager(wager);
    const handBob = declassify(interact.getHand());
  });
  Bob.publish(handBob)
    .pay(wager);"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">27</span>      <font class="badlink"><span class="nx">Bob</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28only%29%29%29" class="k" data-pltdoc="x">only</a><span class="p">(()</span> <a href="ref-programs-compute.html#%28reach._%28%28~3d._~3e%29%29%29" class="o" data-pltdoc="x">=&gt;</a> <span class="p">{</span>
<span class="mi">28</span>        <a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">acceptWager</span></font><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="mi">29</span>        <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">handBob</span></font> <font class="badlink"><span class="o">=</span></font> <a href="ref-programs-local.html#%28reach._%28%28declassify%29%29%29" class="k" data-pltdoc="x">declassify</a><span class="p">(</span><a href="ref-programs-local.html#%28reach._%28%28interact%29%29%29" class="k" data-pltdoc="x">interact</a><span class="p">.</span><font class="badlink"><span class="nx">getHand</span></font><span class="p">());</span>
<span class="mi">30</span>      <span class="p">});</span>
<span class="mi">31</span>      <font class="badlink"><span class="nx">Bob</span></font><span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a><span class="p">(</span><font class="badlink"><span class="nx">handBob</span></font><span class="p">)</span>
<span class="mi">32</span>        <span class="p">.</span><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a><span class="p">(</span><font class="badlink"><span class="nx">wager</span></font><span class="p">);</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Line 28 has Bob accept the wager.
If he doesn&rsquo;t like the terms, his <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a> can just not respond to this method and the <a href="ref-model.html#%28tech._dapp%29" class="techoutside" data-pltdoc="x"><span class="techinside">DApp</span></a> will stall.</p></li><li><p>Line 32 has Bob pay the wager as well.</p></li></ul><p>The <a href="ref-model.html#%28tech._dapp%29" class="techoutside" data-pltdoc="x"><span class="techinside">DApp</span></a> is now running in a <a href="ref-model.html#%28tech._consensus._step%29" class="techoutside" data-pltdoc="x"><span class="techinside">consensus step</span></a> and
the contract itself now holds twice the wager amount.
Before, it would compute the outcome and then commit the state; but now, it needs to look at the outcome and use it to balance the account.</p><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed"><tr><td><p><a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh#L34-L41"><span class="stt">rps-3-bets/index.rsh</span></a><button class="btn" data-clipboard-text="  const outcome = (handAlice + (4 - handBob)) % 3;
  const            [forAlice, forBob] =
    outcome == 2 ? [       2,      0] :
    outcome == 0 ? [       0,      2] :
    /* tie      */ [       1,      1];
  transfer(forAlice * wager).to(Alice);
  transfer(forBob   * wager).to(Bob);
  commit();"><img class="clippy" width="13" src="clippy.svg" alt="Copy to clipboard"> </img></button>&nbsp;</p></td></tr></table></div><div class="SIntrapara"><div class="highlight"><pre><span></span><span class="p">..</span>    <span class="c1">// ...</span>
<span class="mi">34</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a> <font class="badlink"><span class="nx">outcome</span></font> <font class="badlink"><span class="o">=</span></font> <span class="p">(</span><font class="badlink"><span class="nx">handAlice</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2B%29%29%29" class="o" data-pltdoc="x">+</a> <span class="p">(</span><span class="mi">4</span> <a href="ref-programs-compute.html#%28reach._%28%28-%29%29%29" class="o" data-pltdoc="x">-</a> <font class="badlink"><span class="nx">handBob</span></font><span class="p">))</span> <a href="ref-programs-compute.html#%28reach._%28%28~25%29%29%29" class="o" data-pltdoc="x">%</a> <span class="mi">3</span><span class="p">;</span>
<span class="mi">35</span>      <a href="ref-programs-compute.html#%28reach._%28%28const%29%29%29" class="kd" data-pltdoc="x">const</a>            <span class="p">[</span><font class="badlink"><span class="nx">forAlice</span></font><span class="p">,</span> <font class="badlink"><span class="nx">forBob</span></font><span class="p">]</span> <font class="badlink"><span class="o">=</span></font>
<span class="mi">36</span>        <font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <span class="mi">2</span> <a href="ref-programs-compute.html#%28reach._%28%28~3f%29%29%29" class="o" data-pltdoc="x">?</a> <span class="p">[</span>       <span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">]</span> <font class="badlink"><span class="o">:</span></font>
<span class="mi">37</span>        <font class="badlink"><span class="nx">outcome</span></font> <a href="ref-programs-compute.html#%28reach._%28%28~3d~3d%29%29%29" class="o" data-pltdoc="x">==</a> <span class="mi">0</span> <a href="ref-programs-compute.html#%28reach._%28%28~3f%29%29%29" class="o" data-pltdoc="x">?</a> <span class="p">[</span>       <span class="mi">0</span><span class="p">,</span>      <span class="mi">2</span><span class="p">]</span> <font class="badlink"><span class="o">:</span></font>
<span class="mi">38</span>        <span class="cm">/* tie      */</span> <span class="p">[</span>       <span class="mi">1</span><span class="p">,</span>      <span class="mi">1</span><span class="p">];</span>
<span class="mi">39</span>      <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">forAlice</span></font> <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="nx">wager</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Alice</span></font><span class="p">);</span>
<span class="mi">40</span>      <a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a><span class="p">(</span><font class="badlink"><span class="nx">forBob</span></font>   <a href="ref-programs-compute.html#%28reach._%28%28%2A%29%29%29" class="o" data-pltdoc="x">*</a> <font class="badlink"><span class="nx">wager</span></font><span class="p">).</span><font class="badlink"><span class="nx">to</span></font><span class="p">(</span><font class="badlink"><span class="nx">Bob</span></font><span class="p">);</span>
<span class="mi">41</span>      <a href="ref-programs-consensus.html#%28reach._%28%28commit%29%29%29" class="k" data-pltdoc="x">commit</a><span class="p">();</span>
<span class="p">..</span>    <span class="c1">// ...</span>
</pre></div></div></p><ul><li><p>Lines 35 through 38 compute the amounts given to each participant depending on the outcome by determining how many <code class="highlight"><font class="badlink"><span class="nx">wager</span></font></code> amounts each party gets.
If the outcome is <code class="highlight"><span class="mi">2</span></code>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Alice wins</span><span class="hspace"></span></span>, then she gets two portions; while if it is <code class="highlight"><span class="mi">0</span></code>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">Bob wins</span><span class="hspace"></span></span>, then he gets two portions; otherwise they each get one portion.</p></li><li><p>Lines 39 and 40 transfer the corresponding amounts.
This transfer takes place from the contract to the participants, not from the participants to each other, because all of the funds reside inside of the contract.</p></li><li><p>Line 41 commits the state of the application and allows the participants to see the outcome and complete.</p></li></ul><p>At this point, we can run the program and see its output by running</p><p><span class="hspace">&nbsp;&nbsp;</span><span style="font-weight: bold"><span class="stt">$</span></span><span class="stt"> </span><span class="stt">./reach run</span></p><p>Since the players act randomly, the results will be different every time.
When I ran the program three times, this is the output I got:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.</span></p></td></tr><tr><td><p><span class="stt">Bob played Rock</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 104.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 94.9999.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Paper</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Bob wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 94.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 104.9999.</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;</span></p></td></tr><tr><td><p><span class="stt">$ ./reach run</span></p></td></tr><tr><td><p><span class="stt">Alice played Rock</span></p></td></tr><tr><td><p><span class="stt">Bob accepts the wager of 5.</span></p></td></tr><tr><td><p><span class="stt">Bob played Scissors</span></p></td></tr><tr><td><p><span class="stt">Alice saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Bob saw outcome Alice wins</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 104.9999.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 94.9999.</span></p></td></tr></table></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come Alice and Bob&rsquo;s balances go back to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">100</span><span class="hspace"></span></span> every time?
It&rsquo;s because each time we run <span class="stt">./reach run</span>, it creates fresh accounts for both players.</p></blockquote></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>How come the balances aren&rsquo;t exactly <span class="RktInBG"><span class="hspace"></span><span class="RktIn">100</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">105</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">95</span><span class="hspace"></span></span>?
It&rsquo;s because consensus network charge fees to run transactions.</p><p>If we had shown all the decimals, they&rsquo;d look like this:</p><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">Alice went from 100 to 104.999999999999687163.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 94.999999999999978229.</span></p></td></tr><tr><td><p><span class="stt">...</span></p></td></tr><tr><td><p><span class="stt">Alice went from 100 to 94.999999999999687163.</span></p></td></tr><tr><td><p><span class="stt">Bob went from 100 to 104.999999999999978246.</span></p></td></tr></table><p><span style="font-weight: bold">&#8212;<wbr></wbr></span></p><p>Why does Alice win slightly less than Bob when she wins?
She has to pay to <a href="ref-model.html#%28tech._deploy%29" class="techoutside" data-pltdoc="x"><span class="techinside">deploy</span></a> the contract, because she publishes the first message in her <a href="ref-model.html#%28tech._frontend%29" class="techoutside" data-pltdoc="x"><span class="techinside">frontend</span></a>.</p></blockquote></blockquote></blockquote><p>Alice is doing okay - if she keeps this up, she&rsquo;ll make a fortune on <span class="emph">Rock, Paper, Scissors!</span>!</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>If your version isn&rsquo;t working, look at the complete versions of <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.rsh"><span class="stt">rps-3-bets/index.rsh</span></a> and <a href="https://github.com/reach-sh/reach-lang/blob/master/examples/rps-3-bets/index.mjs"><span class="stt">rps-3-bets/index.mjs</span></a> to make sure you copied everything down correctly!</p></blockquote></blockquote></blockquote><p>Now that there is a reason to play this game, it turns out that there&rsquo;s a major security vulnerability.
We&rsquo;ll fix this in <a href="tut-5.html" data-pltdoc="x">the next step</a>; make sure you don&rsquo;t launch with this version, or Alice is going to go broke!</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><div class="SIntrapara">Check your understanding: How do Reach programs manage token funds? </div><div class="SIntrapara"><ol><li><p>They don&#8217;t; you need to manage them explicitly in parallel to the Reach program;</p></li><li><p>The <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a></code> primitive can be added to a <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28publish%29%29%29" class="k" data-pltdoc="x">publish</a></code> primitive to send funds to the Reach program, which can then use the <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a></code> primitive to send funds back to participants, and other addresses.</p></li></ol></div><div class="SIntrapara"><blockquote class="check-answer"><p><div class="SIntrapara">Answer: </div><div class="SIntrapara"><p class="check-answer-body">2; the <code class="highlight"><a href="ref-programs-step.html#%28reach._%28%28pay%29%29%29" class="k" data-pltdoc="x">pay</a></code> and <code class="highlight"><a href="ref-programs-consensus.html#%28reach._%28%28transfer%29%29%29" class="k" data-pltdoc="x">transfer</a></code> primitives do everything for you.</p></div></p></blockquote></div></p></blockquote></blockquote></blockquote><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" id="searchbox" type="text" tabindex="1" placeholder="...search docs..." title="Enter a search string to search the Reach documentation" onkeypress="return reach_DoSearch(event, this);"></form>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="tut-3.html" title="backward to &quot;2.3 Rock, Paper, and Scissors&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="tut.html" title="up to &quot;2 Tutorial&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="tut-5.html" title="forward to &quot;2.5 Trust and Commitments&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div><script src="reach-post.js"></script></body></html>